"use strict";export default class jTDAL{static t=["condition","repeat","content","replace","attributes","omittag"];static i="(?:[\\w\\-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w\\-\\/]*[\\w])*)";static l="STRING:(?:[^;](?:(?!<=;);)?)+";static o="MACRO:[a-zA-Z0-9-]+";static A="(?:(?:!)?[\\w\\-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w\\-\\/]*[\\w])*)";static u="(?:"+jTDAL.l+"|(?:"+jTDAL.A+")(?:[\\s*]\\|[\\s*]"+jTDAL.l+")?)";static T="(?:"+jTDAL.o+"|"+jTDAL.l+"|"+jTDAL.A+"(?:[\\s*]\\|[\\s*]"+jTDAL.l+")?)";static p=new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+jTDAL.t.join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i");static j=new RegExp("(?<=\\s)((?:[\\w\\-]+:)?[\\w\\-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi");static L=new RegExp("(?:{("+jTDAL.i+")}|{\\?("+jTDAL.A+")}(.*?){\\/\\2})");static D=new RegExp("^[\\s]*("+jTDAL.u+")[\\s]*$");static h=new RegExp("^[\\s]*([\\w\\-]+?)[\\s]+("+jTDAL.i+")[\\s]*$");static R=new RegExp("^[\\s]*(?:(structure)[\\s]+)?("+jTDAL.T+")[\\s]*$");static P=new RegExp("[\\s]*(?:(?:([\\w\\-]+?)[\\s]+("+jTDAL.u+")[\\s]*)(?:;;[\\s]*|$))","g");static m=new RegExp("\\s*(data-tdal-[\\w\\-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi");static S=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];_={};static v(t,e={}){let r='""',s=null;for(;null!=(s=jTDAL.L.exec(t));)if(0<s.index&&(r+="+"+JSON.stringify(String(t.substring(0,s.index)))),t=t.substring(s.index+s[0].length),s[1])r+="+(a("+jTDAL.N(s[1],!1,e)+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?t[t[0]]:"")';else if(s[2]){const t=jTDAL.N(s[2],!0,e);"true"===t?r+="+"+this.v(s[3],e):"false"!==t&&(r+="+(true==="+t+'?""+'+this.v(s[3],e)+':"")')}return 0<t.length&&(r+="+"+JSON.stringify(String(t))),r}static N(t,e=!1,r={}){let s="";if(t)t:{const a=t.split("|"),i=a.length;for(let t=0;t<i;++t){0!=t&&(s+="||");let i=a[t].replace(/^\s+/,"");if(i.startsWith("STRING:")){s+="("+this.v(i.substring(7))+")";break t}if(i.startsWith("MACRO:")){void 0!==r[i.substring(6)]?s+='("function"===typeof m["'+i.substring(6)+'"]?m["'+i.substring(6)+'"]():false)':s+="false";break t}{i=i.replace(/\s+$/,"");const t="!"===i[0],r=e||t,a=(t?i.substring(1):i).split("/");if(0<a.length&&0<a[0].length)switch(a[0]){case"FALSE":s+=t?"true":"false";break t;case"TRUE":s+=t?"false":"true";break t;case"REPEAT":3==a.length&&(s+=(r?(t?"!":"")+"b(":"")+'c(r,"'+a.join("/")+'")'+(r?")":""));break;case"GLOBAL":1<a.length&&0<a[1].length&&(s+=(r?(t?"!":"")+"b(":"")+'c(d,"'+a.slice(1).join("/")+'")'+(r?")":""));break;default:s+=r?(t?"!(":"")+'(a(c(r,"'+a.join("/")+'"))&&false!==b(t[t[0]]))||(a(c(d,"'+a.join("/")+'"))&&false!==b(t[t[0]]))'+(t?")":""):'((a(c(r,"'+a.join("/")+'"))||a(c(d,"'+a.join("/")+'")))?t[t[0]]:false)'}}}}else s="false";return s}O(t){let e="",r=null;const s="data-tdal-";for(;null!==(r=jTDAL.p.exec(t));){0<r.index&&(e+="+"+JSON.stringify(String(t.substring(0,r.index)))),t=t.substring(r.index+r[0].length);let a,i={};for(;null!==(a=jTDAL.j.exec(r[0]));)i[a[1]]=a;let n=["",r[0],"","","","","",""];n[1]=n[1].replace(jTDAL.m,"");let l=!!r[6]||jTDAL.S.includes(r[1].toLowerCase());if(!l){let e=[];const s=new RegExp("<(\\/)?"+r[1]+"[^<>]*(?<!\\/)>","gi");let i=1;for(;void 0===e[0]&&null!==(a=s.exec(t));)a[1]?i--:i++,0==i&&(e=[a.index,a[0].length]);void 0===e[0]?l=!0:(n[4]+=this.O(t.substring(0,e[0])),n[6]+=t.substring(e[0],e[0]+e[1]),t=t.substring(e[0]+e[1]))}t:{let t,e=s+jTDAL.t[0];if(i[e]&&jTDAL.D.exec(i[e][3])){let t=jTDAL.N(i[e][3],!0,this._);if("false"===t)break t;"true"!==t&&(n[0]+="+(true==="+t+'?""',n[7]=':"")'+n[7])}if(e=s+jTDAL.t[1],i[e]&&(t=jTDAL.h.exec(i[e][3]))){let e=jTDAL.N(t[2],!1,this._);if("false"==e||'""'==e||"true"==e)break t;n[0]+="+(",n[0]+="((",n[0]+="a("+e+")&&",n[0]+="(!Array.isArray(t[t[0]])||(t[t[0]]=Object.assign({},t[t[0]])))&&",n[0]+='("object"===typeof t[t[0]]&&null!==t[t[0]]&&Object.keys(t[t[0]]).length)',n[0]+=")?((t[++t[0]]=1)&&t[0]++):((t[0]+=2)&&false))",n[0]+="?",n[0]+="Object.keys(t[t[0]-2]).reduce((o,e)=>{",n[0]+='r["'+t[1]+'"]=t[t[0]-2][e];',n[0]+='r["REPEAT"]["'+t[1]+'"]={};',n[0]+='r["REPEAT"]["'+t[1]+'"]["index"]=e;',n[0]+='r["REPEAT"]["'+t[1]+'"]["number"]=t[t[0]-1]++;',n[0]+='r["REPEAT"]["'+t[1]+'"]["even"]=0==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',n[0]+='r["REPEAT"]["'+t[1]+'"]["odd"]=1==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',n[0]+='r["REPEAT"]["'+t[1]+'"]["first"]=1==r["REPEAT"]["'+t[1]+'"]["number"];',n[0]+='r["REPEAT"]["'+t[1]+'"]["length"]=Object.keys(t[t[0]-2]);',n[0]+='r["REPEAT"]["'+t[1]+'"]["last"]=r["REPEAT"]["'+t[1]+'"]["length"]==r["REPEAT"]["'+t[1]+'"]["number"];',n[0]+="return o",n[7]=';},""):"")+((t[0]-=2)&&(delete r["REPEAT"]["'+t[1]+'"])&&delete(r["'+t[1]+'"])?"":"")'+n[7]}if(e=s+jTDAL.t[2],i[e]&&(t=jTDAL.R.exec(i[e][3]))){let e=jTDAL.N(t[2],!1,this._);if("false"==e)n[4]="";else if("true"!=e){let r=["",""];"structure"!=t[1]&&(r[0]="String(",r[1]=').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),n[3]+="+(a("+e+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?'+r[0]+"t[t[0]]"+r[1]+':(true!==t[t[0]]?"":""',n[5]+="))"}}else if(e=s+jTDAL.t[3],i[e]&&(t=jTDAL.R.exec(i[e][3]))){let e=jTDAL.N(t[2],!1,this._);if("false"==e)n[1]="",n[4]="",n[6]="";else if("true"!=e){let r=["",""];"structure"!=t[1]&&(r[0]="String(",r[1]=').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),n[0]+="+(a("+e+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?'+r[0]+"t[t[0]]"+r[1]+':(true!==t[t[0]]?"":""',n[7]="))"+n[7]}}if(e=s+jTDAL.t[4],i[e]&&(t=jTDAL.P.exec(i[e][3])))for(;null!==t;){let r=jTDAL.N(t[2],!1,this._);"false"===r?void 0!==i[t[1]]&&(n[1]=n[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),"")):"true"!==r&&(n[2]+="+(a("+r+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?" '+t[1]+'=\\""+t[t[0]]+"\\"":(true!==t[t[0]]?"":"'+t[1]+'"',void 0!==i[t[1]]&&(n[1]=n[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),""),n[2]+=void 0!==i[t[1]][3]&&""!=i[t[1]][3]?'+"="+'+JSON.stringify(String(i[t[1]][2]+i[t[1]][3]+i[t[1]][2])):""),n[2]+="))"),t=jTDAL.P.exec(i[e][3])}if(e=s+jTDAL.t[5],i[e]&&jTDAL.D.exec(i[e][3])){let t=jTDAL.N(i[e][3],!0,this._);"true"==t?(n[1]="",n[6]=""):"false"!=t&&(n[0]+="+("+t+'?"":""',n[3]=")"+n[3],n[5]+="+("+t+'?"":""',n[7]=")"+n[7])}}n[1]=n[1].replace(/\s*\/?>$/,""),!l||""==n[4]&&""==n[3]&&""==n[5]||(n[6]="</"+r[1]+">",l=!1),e+=n[0]+"+"+JSON.stringify(String(n[1]))+n[2]+(""!=n[1]?'+"'+(l?"/":"")+'>"':"")+n[3]+n[4]+n[5]+"+"+JSON.stringify(String(n[6]))+n[7]}return e+="+"+JSON.stringify(String(t)),e}MacroAdd(t,e,r=!0,s=!0){let a=!1;return t.match(/[a-zA-Z0-9]/)&&(a=!0,this._[t]='""'+this.O(s?e.replace(/<!--.*?-->/gs,""):e),r&&(this._[t]="("+this._[t]+").trim()")),a}constructor(t=[],e=!0,r=!0){const s=t.length;for(let a=0;a<s;a++)this.MacroAdd(t[a][0],t[a][1],e,r)}k(t,e=!0,r=!0){let s=this.O(r?t.replace(/<!--.*?-->/gs,""):t),a='const r={"REPEAT":{}}';a+=",t=[1]",a+=",m={"+Object.keys(this._).map((t=>'"'+t+'":()=>'+this._[t])).join(",")+"}",a+=",a=(e)=>{",a+="t[t[0]]=e;",a+="return false!==t[t[0]]",a+="}",a+=",c=(a,b)=>{",a+='let z=!1,y=b.split("/"),x,w;',a+="if(0<y.length&&0<y[0].length)",a+="for(z=a,x=0;x<y.length&&1!==z;x++)",a+='z="object"===typeof z&&null!==z&&void 0!==(w="function"===typeof z[y[x]]?z[y[x]](d,r):z[y[x]])&&w;',a+="return z",a+="}",a+=",b=(v)=>{",a+='return "object"===typeof v?null!==v&&0<Object.keys(v).length:(Array.isArray(v)?0<v.length:void 0!==typeof v&&false!==v&&""!==v)',a+="}",a+=";";const i=["",""];e&&(i[0]="(",i[1]=").trim()"),a+="return "+i[0]+'""'+s+i[1],s="";do{s=a,a=a.replace(/(?<!\\)"\+"/g,"").replace('(true!==t[t[0]]?"":"")','""')}while(s!=a);return a}CompileToFunction(t,e=!0,r=!0){return new Function("d",this.k(t,e,r))}CompileToString(t,e=!0,r=!0){return"function(d){"+this.k(t,e,r)+"}"}}