"use strict";var jTDAL;!function(e){const t="(?:[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",r="(?:(?:!)?[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",i="(STRING:(?:[^;](?:(?!<=;);)?)+|"+r+")",n={tagWithTDAL:new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+["condition","repeat","content","replace","attributes","omittag"].join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i"),tagWithAttribute:new RegExp("<((?:w+:)?w+)(s+[^<>]+?)??s+%s=(['\"])(.*?)\\3(s+[^<>]+?)??s*(/)?>","i"),tagAttributes:new RegExp("(?<=\\s)((?:[\\w-]+:)?[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi"),pathString:new RegExp("(?:{("+t+")}|{\\?("+r+")}(.*?){\\?\\2})"),pathInString:new RegExp("{("+t+")}","g"),conditionInString:new RegExp("{\\?("+r+")}(.*?){\\?\\1}","g"),condition:new RegExp("^[\\s]*("+i+")[\\s]*$"),repeat:new RegExp("^[\\s]*([\\w-]+?)[\\s]+("+t+")[\\s]*$"),content:new RegExp("^[\\s]*(?:(text|structure)[\\s]+)?("+i+")[\\s]*$"),attributes:new RegExp("[\\s]*(?:(?:([\\w-]+?)[\\s]+("+i+")[\\s]*)(?:;;[\\s]*|$))","g"),attributesTDAL:new RegExp("\\s*(data-tdal-[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi")},s=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];let l=!1,a=!1;function u(e){let t='""',r=null;for(;null!=(r=n.pathString.exec(e));)if(0<r.index&&(t+="+"+JSON.stringify(String(e.substr(0,r.index)))),e=e.substr(r.index+r[0].length),r[1])t+="+"+o(r[1]);else if(r[2]){const e=o(r[2],!0);"true"===e?t+="+"+u(r[3]):"false"!==e&&(t+="+(true==="+e+'?""+'+u(r[3])+':"")')}return 0<e.length&&(t+="+"+JSON.stringify(String(e))),t}function o(e,t=!1){let r="";if(e){let i=0;e:{const n=e.split("|"),s=n.length;for(let e=0;e<s;++e){0!=e&&(r+="||");const s=n[e].replace(/^\s+/,"");if(s.startsWith("STRING:")){r+="("+u(s.substr(7))+")";break e}{const e="!"===s[0],n=t||e,u=(e?s.substring(1):s).split("/");if(0<u.length&&0<u[0].length)switch(u[0]){case"FALSE":r+=e?"true":"false";break e;case"TRUE":r+=e?"false":"true";break e;case"REPEAT":3==u.length&&(r+="("+(n?(e?"!":"")+"b(":"")+'c(r,"'+u.join("/")+'")'+(n?")":""));break;case"GLOBAL":1<u.length&&0<u[1].length&&(l=!0,a||=n,r+=(n?(e?"!":"")+"b(":"")+'c(d,"'+u.slice(1).join("/")+'")'+(n?")":""));break;default:i++,l=!0,a||=n,r+="("+(n?(e?"(!":"")+"b(":"")+'c(r,"'+u.join("/")+'")'+(n?")":""),r+=n&&e?"&&":"||",r+=(n?(e?"!":"")+"b(":"")+'c(d,"'+u.join("/")+'")'+(n?")"+(e?")":""):"")}}}}for(let e=0;e<i;e++)r+=")"}else r="false";return r}function f(e){let t="",r=null;for(;null!==(r=n.tagWithTDAL.exec(e));){0<r.index&&(t+="+"+JSON.stringify(String(e.substr(0,r.index)))),e=e.substr(r.index+r[0].length);let i,l={};for(;null!==(i=n.tagAttributes.exec(r[0]));)l[i[1]]=i;let a=["",r[0],"","","","","",""];a[1]=a[1].replace(n.attributesTDAL,"");let u=!!r[6]||s.includes(r[1].toLowerCase());if(!u){let t=[];const n=new RegExp("<(\\/)?"+r[1]+"[^<>]*(?<!\\/)>","gi");let s=1;for(;void 0===t[0]&&null!==(i=n.exec(e));)i[1]?s--:s++,0==s&&(t=[i.index,i[0].length]);void 0===t[0]?u=!0:(a[4]+=f(e.substr(0,t[0])),a[6]+=e.substr(t[0],t[1]),e=e.substr(t[0]+t[1]))}e:{if(l["data-tdal-condition"]&&n.condition.exec(l["data-tdal-condition"][3])){let e=o(l["data-tdal-condition"][3],!0);if("false"===e)break e;"true"!==e&&(a[0]+="+(true==="+e+'?""',a[7]=':"")'+a[7])}let e;if(l["data-tdal-repeat"]&&(e=n.repeat.exec(l["data-tdal-repeat"][3]))){let t=o(e[2]);if("false"==t||'""'==t||"true"==t)break e;a[0]+="+(",a[0]+="false!==(t[i++]="+t+")&&",a[0]+="(!Array.isArray(t[--i])||(t[i]=Object.assign({},t[i])))&&",a[0]+='("object"===typeof t[i]&&null!==t[i]&&0<Object.keys(t[i++]).length)&&(t[i++]=1)',a[0]+="?",a[0]+="Object.keys(t[i-2]).reduce((o,e)=>{",a[0]+='r["'+e[1]+'"]=t[i-2][e];',a[0]+='r["REPEAT"]["'+e[1]+'"]={};',a[0]+='r["REPEAT"]["'+e[1]+'"]["index"]=e;',a[0]+='r["REPEAT"]["'+e[1]+'"]["number"]=t[i-1]++;',a[0]+='r["REPEAT"]["'+e[1]+'"]["even"]=0==(r["REPEAT"]["'+e[1]+'"]["number"]%2);',a[0]+='r["REPEAT"]["'+e[1]+'"]["odd"]=1==(r["REPEAT"]["'+e[1]+'"]["number"]%2);',a[0]+='r["REPEAT"]["'+e[1]+'"]["first"]=1==r["REPEAT"]["'+e[1]+'"]["number"];',a[0]+='r["REPEAT"]["'+e[1]+'"]["length"]=Object.keys(t[i-2]);',a[0]+='r["REPEAT"]["'+e[1]+'"]["last"]=r["REPEAT"]["'+e[1]+'"]["length"]==r["REPEAT"]["'+e[1]+'"]["number"];',a[0]+="return o",a[7]=';},""):"")+((i-=2)?"":"")'+a[7]}if(l["data-tdal-content"]&&(e=n.content.exec(l["data-tdal-content"][3]))){let t=o(e[2]);if("false"==t)a[4]="";else if("true"!=t){let r=["",""];"structure"!=e[1]&&(r[0]="(new String(",r[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),a[3]+="+(false!==(t[i++]="+t+')&&("string"===typeof t[--i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+r[0]+"t[i]"+r[1]+':(true!==t[i]?"":""',a[5]+="))"}}else if(l["data-tdal-replace"]&&(e=n.content.exec(l["data-tdal-replace"][3]))){let t=o(e[2]);if("false"==t)a[1]="",a[4]="",a[6]="";else if("true"!=t){let r=["",""];"structure"!=e[1]&&(r[0]="(new String(",r[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),a[0]+="+(false!==(t[i++]="+t+')&&("string"===typeof t[--i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+r[0]+"t[i]"+r[1]+':(true!==t[i]?"":""',a[7]="))"+a[7]}}if(l["data-tdal-attributes"]&&(e=n.attributes.exec(l["data-tdal-attributes"][3])))for(;null!==e;){let t=o(e[2]);"false"===t?void 0!==l[e[1]]&&(a[1]=a[1].replace(new RegExp("\\s*"+e[1]+"(?:=(['\"]).*?\\1)?"),"")):"true"!==t&&(a[2]+="+(false!==(t[i++]="+t+')&&("string"===typeof t[--i]||("number"===typeof t[i]&&!isNaN(t[i])))?" '+e[1]+'=\\""+t[i]+"\\"":(true!==t[i]?"":"'+e[1]+'"',void 0!==l[e[1]]&&(a[1]=a[1].replace(new RegExp("\\s*"+e[1]+"(?:=(['\"]).*?\\1)?"),""),a[2]+=void 0!==l[e[1]][3]&&""!=l[e[1]][3]?'+"="+'+JSON.stringify(String(l[e[1]][2]+l[e[1]][3]+l[e[1]][2])):""),a[2]+="))"),e=n.attributes.exec(l["data-tdal-attributes"][3])}if(l["data-tdal-omittag"]&&n.condition.exec(l["data-tdal-omittag"][3])){let e=o(l["data-tdal-omittag"][3],!0);"true"==e?(a[1]="",a[6]=""):"false"!=e&&(a[0]+="+("+e+'?"":""',a[3]=")"+a[3],a[5]+="+("+e+'?"":""',a[7]=")"+a[7])}}a[1]=a[1].replace(/\s*\/?>$/,""),!u||""==a[4]&&""==a[3]&&""==a[5]||(a[6]="</"+r[1]+">",u=!1),t+=a[0]+"+"+JSON.stringify(String(a[1]))+a[2]+(""!=a[1]?'+"'+(u?"/":"")+'>"':"")+a[3]+a[4]+a[5]+"+"+JSON.stringify(String(a[6]))+a[7]}return t+="+"+JSON.stringify(String(e)),t}function g(e,t=!0,r=!0){const i=f(r?e.replace(/<!--.*?-->/gs,""):e).replace(/(?<!\\)""\+/,"").replace(/(?<!\\)"\+"/g,"").replace(/\+""$/,"");return(l?'const c=(a,b)=>{let z=!1,y=b.split("/"),x,w;if(0<y.length&&0<y[0].length)for(z=a,x=0;x<y.length&&1!==z;x++)z="object"===typeof z&&null!==z&&void 0!==(w="function"===typeof z[y[x]]?z[y[x]](r,d):z[y[x]])&&w;return z}'+(a?',b=(v)=>{return "object"===typeof v?null!==v&&0<Object.keys(v).length:(Array.isArray(v)?0<v.length:void 0!==typeof v&&false!==v&&""!==v)}':"")+";":"")+'let r={"REPEAT":{}},i=0,t=[];return '+(t?"(":"")+'""'+i+(t?").trim()":"")}e.CompileToFunction=function(e,t=!0,r=!0){return new Function("d",g(e,t,r))},e.CompileToString=function(e,t=!0,r=!0){return"function(d){"+g(e,t,r)+"}"}}(jTDAL||(jTDAL={}));export default{CompileToFunction:jTDAL.CompileToFunction,CompileToString:jTDAL.CompileToString};