"use strict";var jTDAL;!function(t){const e="(?:[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",i="(STRING:[^;]+|(?:(?:!)?[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*))",r={pathString:new RegExp("^[\\s]*STRING:(.*)$"),tagWithTDAL:new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+["condition","repeat","content","replace","attributes","omittag"].join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i"),tagWithAttribute:new RegExp("<((?:w+:)?w+)(s+[^<>]+?)??s+%s=(['\"])(.*?)\\3(s+[^<>]+?)??s*(/)?>","i"),tagAttributes:new RegExp("(?<=\\s)((?:[\\w-]+:)?[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi"),pathInString:new RegExp("{("+e+")}","g"),condition:new RegExp("^[\\s]*("+i+")[\\s]*$"),repeat:new RegExp("^[\\s]*([\\w-]+?)[\\s]+("+e+")[\\s]*$"),content:new RegExp("^[\\s]*(?:(text|structure)[\\s]+)?("+i+")[\\s]*$"),attributes:new RegExp("[\\s]*(?:(?:([\\w-]+?)[\\s]+("+i+")[\\s]*)(?:;[\\s]*|$))","g"),attributesTDAL:new RegExp("\\s*(data-tdal-[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi")},n=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];function s(t,e=!1){let i="";if(t){let n=0;t:{const l=t.split("|"),f=l.length;for(let t=0;t<f;++t){const f=l[t].trim();if(r.pathString.exec(f)){let t="",e=f.indexOf("STRING:")+7,n=null;for(;null!=(n=r.pathInString.exec(f));)0<t.length&&(t+="+"),0<n.index-e&&(t+=JSON.stringify(String(f.substr(e,n.index-e)))+"+"),t+="("+s(n[1])+")",e=n.index+n[0].length;f.length>e&&(0<t.length&&(t+="+"),t+=JSON.stringify(String(f.substr(e)))),i+="("+t+")";break t}const a="!"===f[0],o=e||a,u=(a?f.substring(1):f).split("/");if(0<u.length&&0<u[0].length)switch(u[0]){case"FALSE":i+=a?"true":"false";break t;case"TRUE":i+=a?"false":"true";break t;case"REPEAT":if(3==u.length){n++,i+=(o?"("+(a?"!":""):"")+'("undefined"!==typeof r["REPEAT"]&&',i+='"undefined"!==typeof r["REPEAT"]["'+u[1]+'"]&&';let t='r["REPEAT"]["'+u[1]+'"]["'+u[2]+'"]';i+='"undefined"!==typeof '+t,i+=(o?")?false!==(t[i]="+t+")&&null!==t[i]":"?"+t)+":"}break;case"GLOBAL":if(1<u.length){const t=u.length;i+=(o?a?"!(":"(":"")+'"object"===typeof (t[i]=d)';for(let e=1;e<t;++e){i+="&&";let t='t[i]["'+u[e]+'"]';i+='"undefined"!==typeof ',i+='(t[i]=("function"===typeof '+t+"?"+t+"(r,d)):"+t+")"}i+=(o?'?"object"===typeof t[i]?0<Object.keys(t[i]).length:(Array.isArray(t[i])?0<t[i].length:false!==t[i]&&null!==t[i]):false)?true':"?t[i]")+":"}break;default:{const t=u.length;n++,i+="("+(o?(a?"!":"")+"(":"")+'"object"===typeof (t[i]=r)';for(let e=0;e<t;++e){i+="&&";let t='t[i]["'+u[e]+'"]';i+='"undefined"!==typeof ',i+='(t[i]=("function"===typeof '+t+"?"+t+"(d,r):"+t+"))"}i+=o?'?"object"===typeof t[i]?0<Object.keys(t[i]).length:(Array.isArray(t[i])?0<t[i].length:false!==t[i]&&null!==t[i]):false)'+(a?"&&":"||"):"?t[i]:",i+=(o?(a?"!":"")+"(":"")+'"object"===typeof (t[i]=d)';for(let e=0;e<t;++e){i+="&&";let t='t[i]["'+u[e]+'"]';i+='"undefined"!==typeof ',i+='(t[i]=("function"===typeof '+t+"?"+t+"(d,r):"+t+"))"}i+=(o?'?"object"===typeof t[i]?0<Object.keys(t[i]).length:(Array.isArray(t[i])?0<t[i].length:false!==t[i]&&null!==t[i]):false)?true':"?t[i]")+":"}}}i+="false"}for(let t=0;t<n;t++)i+=")"}else i="false";return i}function l(t){let e="",i=null;for(;null!==(i=r.tagWithTDAL.exec(t));){0<i.index&&(e+="+"+JSON.stringify(String(t.substr(0,i.index)))),t=t.substr(i.index+i[0].length);let f,a={};for(;null!==(f=r.tagAttributes.exec(i[0]));)a[f[1]]=f;let o=["",i[0],"","","","","",""],u=!!i[6]||n.includes(i[1].toLowerCase());if(!u){let e=[];const r=new RegExp("<(\\/)?"+i[1]+"[^<>]*(?<!\\/)>","gi");let n=1;for(;void 0===e[0]&&null!==(f=r.exec(t));)f[1]?n--:n++,0==n&&(e=[f.index,f[0].length]);void 0===e[0]?u=!0:(o[4]+=l(t.substr(0,e[0])),o[6]+=t.substr(e[0],e[1]),t=t.substr(e[0]+e[1]))}t:{if(a["data-tdal-condition"]&&r.condition.exec(a["data-tdal-condition"][3])){let t=s(a["data-tdal-condition"][3],!0);if("false"===t)break t;"true"!==t&&(o[0]+="+(true==="+t+'?""',o[7]=':"")'+o[7])}let t;if(a["data-tdal-repeat"]&&(t=r.repeat.exec(a["data-tdal-repeat"][3]))){let e=s(t[2]);if("false"==e||'""'==e||"true"==e)break t;o[0]+="+(",o[0]+="false!==(t[i++]="+e+")&&",o[0]+="(!Array.isArray(t[--i])||(t[i]=Object.assign({},t[i])))&&",o[0]+='("object"===typeof t[i]&&0<Object.keys(t[i++]).length)&&(t[i++]=1)',o[0]+="?",o[0]+="Object.keys(t[i-2]).reduce(function(o,e){",o[0]+='r["'+t[1]+'"]=t[i-2][e];',o[0]+='r["REPEAT"]["'+t[1]+'"]={};',o[0]+='r["REPEAT"]["'+t[1]+'"]["index"]=e;',o[0]+='r["REPEAT"]["'+t[1]+'"]["number"]=t[i-1]++;',o[0]+='r["REPEAT"]["'+t[1]+'"]["even"]=0==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',o[0]+='r["REPEAT"]["'+t[1]+'"]["odd"]=1==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',o[0]+='r["REPEAT"]["'+t[1]+'"]["first"]=1==r["REPEAT"]["'+t[1]+'"]["number"];',o[0]+='r["REPEAT"]["'+t[1]+'"]["length"]=Object.keys(t[i-2]);',o[0]+='r["REPEAT"]["'+t[1]+'"]["last"]=r["REPEAT"]["'+t[1]+'"]["length"]==r["REPEAT"]["'+t[1]+'"]["number"];',o[0]+="return o",o[7]=';},""):"")+((i-=2)?"":"")'+o[7]}if(a["data-tdal-content"]&&(t=r.content.exec(a["data-tdal-content"][3]))){let e=s(t[2]);if("false"==e)o[4]="";else if("true"!=e){let i=["",""];"structure"!=t[1]&&(i[0]="(new String(",i[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),o[3]+="+(false!==(t[i++]="+e+')&&("string"===typeof t[--i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+i[0]+"t[i]"+i[1]+':(true!==t[i]?"":""',o[5]+="))"}}else if(a["data-tdal-replace"]&&(t=r.content.exec(a["data-tdal-replace"][3]))){let e=s(t[2]);if("false"==e)o[1]="",o[4]="",o[6]="";else if("true"!=e){let i=["",""];"structure"!=t[1]&&(i[0]="(new String(",i[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),o[0]+="+(false!==(t[i++]="+e+')&&("string"===typeof t[--i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+i[0]+"t[i]"+i[1]+':(true!==t[i]?"":""',o[7]="))"+o[7]}}if(a["data-tdal-attributes"]&&(t=r.attributes.exec(a["data-tdal-attributes"][3])))for(;null!==t;){let e=s(t[2]);"false"===e?void 0!==a[t[1]]&&(o[1]=o[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),"")):"true"!==e&&(o[2]+="+(false!==(t[i++]="+e+')&&("string"===typeof t[--i]||("number"===typeof t[i]&&!isNaN(t[i])))?" '+t[1]+'=\\""+t[i]+"\\"":(true!==t[i]?"":"',void 0!==a[t[1]]?(o[1]=o[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),""),o[2]+=t[1]+'"'+(void 0!==a[t[1]][3]&&""!=a[t[1]][3]?'+"="+'+JSON.stringify(String(a[t[1]][2]+a[t[1]][3]+a[t[1]][2])):"")):o[2]+='"',o[2]+="))"),t=r.attributes.exec(a["data-tdal-attributes"][3])}if(a["data-tdal-omittag"]&&r.condition.exec(a["data-tdal-omittag"][3])){let t=s(a["data-tdal-omittag"][3],!0);"true"==t?(o[1]="",o[6]=""):"false"!=t&&(o[0]+="+("+t+'?"":""',o[3]=")"+o[3],o[5]+="+("+t+'?"":""',o[7]=")"+o[7])}for(;null!==(f=r.attributesTDAL.exec(o[1]));)o[1]=o[1].replace(r.attributesTDAL,"")}o[1]=o[1].replace(/\s*\/?>$/,""),!u||""==o[4]&&""==o[3]&&""==o[5]||(o[6]="</"+i[1]+">",u=!1),e+=o[0]+"+"+JSON.stringify(String(o[1]))+o[2]+(""!=o[1]?'+"'+(u?"/":"")+'>"':"")+o[3]+o[4]+o[5]+"+"+JSON.stringify(String(o[6]))+o[7]}return e+="+"+JSON.stringify(String(t)),e}function f(t,e=!0,i=!0){return('let r={"REPEAT":{}},i=0,t=[];return '+(e?"(":"")+'""'+l(i?t.replace(/\<!--.*?--\>/gs,""):t)).replace(/(?<!\\)""\+/,"").replace(/(?<!\\)"\+"/g,"").replace(/\+""$/,"")+(e?").trim()":"")}t.CompileToFunction=function(t,e=!0,i=!0){return new Function("d",f(t,e,i))},t.CompileToString=function(t,e=!0,i=!0){return"function(d){"+f(t,e,i)+"}"}}(jTDAL||(jTDAL={})),"undefined"!=typeof exports&&(exports.CompileToFunction=jTDAL.CompileToFunction,exports.CompileToString=jTDAL.CompileToString);