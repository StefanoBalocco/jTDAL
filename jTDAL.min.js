"use strict";var jTDAL;!function(t){const e="(?:[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",i="(?:(?:!)?[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",r="(STRING:[^;]+|"+i+")",n={tagWithTDAL:new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+["condition","repeat","content","replace","attributes","omittag"].join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i"),tagWithAttribute:new RegExp("<((?:w+:)?w+)(s+[^<>]+?)??s+%s=(['\"])(.*?)\\3(s+[^<>]+?)??s*(/)?>","i"),tagAttributes:new RegExp("(?<=\\s)((?:[\\w-]+:)?[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi"),pathString:new RegExp("(?:{("+e+")}|{\\?("+i+")}(.*?){\\?\\2})"),pathInString:new RegExp("{("+e+")}","g"),conditionInString:new RegExp("{\\?("+i+")}(.*?){\\?\\1}","g"),condition:new RegExp("^[\\s]*("+r+")[\\s]*$"),repeat:new RegExp("^[\\s]*([\\w-]+?)[\\s]+("+e+")[\\s]*$"),content:new RegExp("^[\\s]*(?:(text|structure)[\\s]+)?("+r+")[\\s]*$"),attributes:new RegExp("[\\s]*(?:(?:([\\w-]+?)[\\s]+("+r+")[\\s]*)(?:;[\\s]*|$))","g"),attributesTDAL:new RegExp("\\s*(data-tdal-[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi")},l=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];function s(t){let e='""',i=null;for(;null!=(i=n.pathString.exec(t));)if(0<i.index&&(e+="+"+JSON.stringify(String(t.substr(0,i.index)))),t=t.substr(i.index+i[0].length),i[1])e+="+"+f(i[1]);else if(i[2]){const t=f(i[2],!0);"true"===t?e+="+"+s(i[3]):"false"!==t&&(e+="+(true==="+t+'?""+'+s(i[3])+':"")')}return 0<t.length&&(e+="+"+JSON.stringify(String(t))),e}function f(t,e=!1){let i="";if(t){let r=0;t:{const n=t.split("|"),l=n.length;for(let t=0;t<l;++t){const l=n[t].replace(/^\s+/,"");if(l.startsWith("STRING:")){i+="("+s(l.substr(7))+")";break t}{const t="!"===l[0],n=e||t,s=(t?l.substring(1):l).split("/");if(0<s.length&&0<s[0].length)switch(s[0]){case"FALSE":i+=t?"true":"false";break t;case"TRUE":i+=t?"false":"true";break t;case"REPEAT":if(3==s.length){r++,i+=(n?"("+(t?"!":""):"")+'("undefined"!==typeof r["REPEAT"]&&',i+='"undefined"!==typeof r["REPEAT"]["'+s[1]+'"]&&';let e='r["REPEAT"]["'+s[1]+'"]["'+s[2]+'"]';i+='"undefined"!==typeof '+e,i+=(n?")?false!==(t[i]="+e+")&&null!==t[i]":"?"+e)+":"}break;case"GLOBAL":if(1<s.length){const e=s.length;i+=(n?t?"!(":"(":"")+'"object"===typeof(t[i]=d)&&null!==t[i]';for(let t=1;t<e;++t){i+="&&";let e='t[i]["'+s[t]+'"]';i+='"undefined"!==typeof',i+='(t[i]=("function"===typeof '+e+"?"+e+"(r,d)):"+e+")"}i+=(n?'?"object"===typeof t[i]?null!==t[i]&&0<Object.keys(t[i]).length:(Array.isArray(t[i])?0<t[i].length:false!==t[i]):false)?true':"?t[i]")+":"}break;default:{const e=s.length;r++,i+="("+(n?(t?"!":"")+"(":"")+'"object"===typeof(t[i]=r)&&null!==t[i]';for(let t=0;t<e;++t){i+="&&";let e='t[i]["'+s[t]+'"]';i+='"undefined"!==typeof',i+='(t[i]=("function"===typeof '+e+"?"+e+"(d,r):"+e+"))"}i+=n?'?"object"===typeof t[i]?null!==t[i]&&0<Object.keys(t[i]).length:(Array.isArray(t[i])?0<t[i].length:false!==t[i]):false)'+(t?"&&":"||"):"?t[i]:",i+=(n?(t?"!":"")+"(":"")+'"object"===typeof(t[i]=d)&&null!==t[i]';for(let t=0;t<e;++t){i+="&&";let e='t[i]["'+s[t]+'"]';i+='"undefined"!==typeof',i+='(t[i]=("function"===typeof '+e+"?"+e+"(d,r):"+e+"))"}i+=(n?'?"object"===typeof t[i]?null!==t[i]&&0<Object.keys(t[i]).length:(Array.isArray(t[i])?0<t[i].length:false!==t[i]):false)?true':"?t[i]")+":"}}}}i+="false"}for(let t=0;t<r;t++)i+=")"}else i="false";return i}function o(t){let e="",i=null;for(;null!==(i=n.tagWithTDAL.exec(t));){0<i.index&&(e+="+"+JSON.stringify(String(t.substr(0,i.index)))),t=t.substr(i.index+i[0].length);let r,s={};for(;null!==(r=n.tagAttributes.exec(i[0]));)s[r[1]]=r;let u=["",i[0],"","","","","",""],a=!!i[6]||l.includes(i[1].toLowerCase());if(!a){let e=[];const n=new RegExp("<(\\/)?"+i[1]+"[^<>]*(?<!\\/)>","gi");let l=1;for(;void 0===e[0]&&null!==(r=n.exec(t));)r[1]?l--:l++,0==l&&(e=[r.index,r[0].length]);void 0===e[0]?a=!0:(u[4]+=o(t.substr(0,e[0])),u[6]+=t.substr(e[0],e[1]),t=t.substr(e[0]+e[1]))}t:{if(s["data-tdal-condition"]&&n.condition.exec(s["data-tdal-condition"][3])){let t=f(s["data-tdal-condition"][3],!0);if("false"===t)break t;"true"!==t&&(u[0]+="+(true==="+t+'?""',u[7]=':"")'+u[7])}let t;if(s["data-tdal-repeat"]&&(t=n.repeat.exec(s["data-tdal-repeat"][3]))){let e=f(t[2]);if("false"==e||'""'==e||"true"==e)break t;u[0]+="+(",u[0]+="false!==(t[i++]="+e+")&&",u[0]+="(!Array.isArray(t[--i])||(t[i]=Object.assign({},t[i])))&&",u[0]+='("object"===typeof t[i]&&null!==t[i]&&0<Object.keys(t[i++]).length)&&(t[i++]=1)',u[0]+="?",u[0]+="Object.keys(t[i-2]).reduce(function(o,e){",u[0]+='r["'+t[1]+'"]=t[i-2][e];',u[0]+='r["REPEAT"]["'+t[1]+'"]={};',u[0]+='r["REPEAT"]["'+t[1]+'"]["index"]=e;',u[0]+='r["REPEAT"]["'+t[1]+'"]["number"]=t[i-1]++;',u[0]+='r["REPEAT"]["'+t[1]+'"]["even"]=0==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',u[0]+='r["REPEAT"]["'+t[1]+'"]["odd"]=1==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',u[0]+='r["REPEAT"]["'+t[1]+'"]["first"]=1==r["REPEAT"]["'+t[1]+'"]["number"];',u[0]+='r["REPEAT"]["'+t[1]+'"]["length"]=Object.keys(t[i-2]);',u[0]+='r["REPEAT"]["'+t[1]+'"]["last"]=r["REPEAT"]["'+t[1]+'"]["length"]==r["REPEAT"]["'+t[1]+'"]["number"];',u[0]+="return o",u[7]=';},""):"")+((i-=2)?"":"")'+u[7]}if(s["data-tdal-content"]&&(t=n.content.exec(s["data-tdal-content"][3]))){let e=f(t[2]);if("false"==e)u[4]="";else if("true"!=e){let i=["",""];"structure"!=t[1]&&(i[0]="(new String(",i[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),u[3]+="+(false!==(t[i++]="+e+')&&("string"===typeof t[--i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+i[0]+"t[i]"+i[1]+':(true!==t[i]?"":""',u[5]+="))"}}else if(s["data-tdal-replace"]&&(t=n.content.exec(s["data-tdal-replace"][3]))){let e=f(t[2]);if("false"==e)u[1]="",u[4]="",u[6]="";else if("true"!=e){let i=["",""];"structure"!=t[1]&&(i[0]="(new String(",i[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),u[0]+="+(false!==(t[i++]="+e+')&&("string"===typeof t[--i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+i[0]+"t[i]"+i[1]+':(true!==t[i]?"":""',u[7]="))"+u[7]}}if(s["data-tdal-attributes"]&&(t=n.attributes.exec(s["data-tdal-attributes"][3])))for(;null!==t;){let e=f(t[2]);"false"===e?void 0!==s[t[1]]&&(u[1]=u[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),"")):"true"!==e&&(u[2]+="+(false!==(t[i++]="+e+')&&("string"===typeof t[--i]||("number"===typeof t[i]&&!isNaN(t[i])))?" '+t[1]+'=\\""+t[i]+"\\"":(true!==t[i]?"":"'+t[1]+'"',void 0!==s[t[1]]&&(u[1]=u[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),""),u[2]+=void 0!==s[t[1]][3]&&""!=s[t[1]][3]?'+"="+'+JSON.stringify(String(s[t[1]][2]+s[t[1]][3]+s[t[1]][2])):""),u[2]+="))"),t=n.attributes.exec(s["data-tdal-attributes"][3])}if(s["data-tdal-omittag"]&&n.condition.exec(s["data-tdal-omittag"][3])){let t=f(s["data-tdal-omittag"][3],!0);"true"==t?(u[1]="",u[6]=""):"false"!=t&&(u[0]+="+("+t+'?"":""',u[3]=")"+u[3],u[5]+="+("+t+'?"":""',u[7]=")"+u[7])}for(;null!==(r=n.attributesTDAL.exec(u[1]));)u[1]=u[1].replace(n.attributesTDAL,"")}u[1]=u[1].replace(/\s*\/?>$/,""),!a||""==u[4]&&""==u[3]&&""==u[5]||(u[6]="</"+i[1]+">",a=!1),e+=u[0]+"+"+JSON.stringify(String(u[1]))+u[2]+(""!=u[1]?'+"'+(a?"/":"")+'>"':"")+u[3]+u[4]+u[5]+"+"+JSON.stringify(String(u[6]))+u[7]}return e+="+"+JSON.stringify(String(t)),e}function u(t,e=!0,i=!0){return('let r={"REPEAT":{}},i=0,t=[];return '+(e?"(":"")+'""'+o(i?t.replace(/<!--.*?-->/gs,""):t)).replace(/(?<!\\)""\+/,"").replace(/(?<!\\)"\+"/g,"").replace(/\+""$/,"")+(e?").trim()":"")}t.CompileToFunction=function(t,e=!0,i=!0){return new Function("d",u(t,e,i))},t.CompileToString=function(t,e=!0,i=!0){return"function(d){"+u(t,e,i)+"}"}}(jTDAL||(jTDAL={})),"undefined"!=typeof exports&&(exports.CompileToFunction=jTDAL.CompileToFunction,exports.CompileToString=jTDAL.CompileToString);