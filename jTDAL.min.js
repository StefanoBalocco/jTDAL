"use strict";var jTDAL;!function(e){const t="(?:[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",r="(STRING:[^;]+|(?:(?:!)?[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*))",i={pathString:new RegExp("^[\\s]*STRING:(.*)$"),tagWithTDAL:new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+["condition","repeat","content","replace","attributes","omittag"].join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i"),tagWithAttribute:new RegExp("<((?:w+:)?w+)(s+[^<>]+?)??s+%s=(['\"])(.*?)\\3(s+[^<>]+?)??s*(/)?>","i"),tagAttributes:new RegExp("(?<=\\s)((?:[\\w-]+:)?[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi"),pathInString:new RegExp("{("+t+")}","g"),condition:new RegExp("^[\\s]*(\\!?)[\\s]*"+r+"[\\s]*$"),repeat:new RegExp("^[\\s]*([\\w-]+?)[\\s]+("+t+")[\\s]*$"),content:new RegExp("^[\\s]*(?:(text|structure)[\\s]+)?("+r+")[\\s]*$"),attributes:new RegExp("[\\s]*(?:(?:([\\w-]+?)[\\s]+"+r+"[\\s]*)(?:;[\\s]*|$))","g"),attributesTDAL:new RegExp("\\s*(data-tdal-[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi")};function n(e){let t="";switch(e){case"true":case"false":t=e;break;default:t=e.startsWith("!(")?"!"+e:"!("+s(e)+")"}return t}function s(e){let t='"undefined"===typeof (t[i++]='+e+')||false===t[--i]||null===t[i]||(Array.isArray(t[i])&&1>t[i].length)||("object"===typeof t[i]&&1>Object.keys(t[i]).length)';switch(e){case"true":t="false";break;case"false":t="true"}return t}function l(e){let t="",r=0;e:{const n=e.split("|"),f=n.length;for(let e=0;e<f;++e){if(i.pathString.exec(n[e])){let r="",s=n[e].indexOf("STRING:")+7,f=null;for(;null!=(f=i.pathInString.exec(n[e]));)0<r.length&&(r+="+"),0<f.index-s&&(r+=JSON.stringify(String(n[e].substr(s,f.index-s)))+"+"),r+="("+l(f[1])+")",s=f.index+f[0].length;n[e].length>s&&(0<r.length&&(r+="+"),r+=JSON.stringify(String(n[e].substr(s)))),t+="("+r+")";break e}const f=n[e].trim().split("/");let a=0<f.length&&0<f[0].length?"!"!=f[0][0]?f[0]:f[0].substr(1):null;if(a)switch(a){case"FALSE":"!"==f[0][0]?t+="true":t+="false";break e;case"TRUE":"!"==f[0][0]?t+="false":t+="true";break e;case"REPEAT":if(3==f.length){r++,t+="('undefined'!==typeof r['REPEAT']&&",t+="'undefined'!==typeof r['REPEAT']['"+f[1]+"']&&";let e="r['REPEAT']['"+f[1]+"']['"+f[2]+"']";t+="'undefined'!==typeof "+e+"?",t+=("!"==f[0][0]?s(e):e)+":"}break;case"GLOBAL":{const e=f.length;let i="d";r++,t+="(";for(let r=0;r<e;++r)0<r&&(t+="&&"),i=i+"['"+f[r]+"']",t+="'undefined'!==typeof "+i;t+="?"+("!"==f[0][0]?s(i):i)+":";break}default:{const e=f.length;let i="r";r++,t+="(";for(let r=0;r<e;++r)0<r&&(t+="&&"),i=i+"['"+f[r]+"']",t+="'undefined'!==typeof "+i;t+="?"+("!"==f[0][0]?"("+s(i)+")":i)+":",i="d",r++,t+="(";for(let r=0;r<e;++r)0<r&&(t+="&&"),i=i+"['"+f[r]+"']",t+="'undefined'!==typeof "+i;t+="?"+("!"==f[0][0]?s(i):i)+":"}}}t+="false"}for(let e=0;e<r;e++)t+=")";return t}function f(e){let t="",r=null;for(;null!==(r=i.tagWithTDAL.exec(e));){0<r.index&&(t+="+"+JSON.stringify(String(e.substr(0,r.index)))),e=e.substr(r.index+r[0].length);let s,a={};for(;null!==(s=i.tagAttributes.exec(r[0]));)a[s[1]]=s;let u=!!r[6],o=[];if(!u){const t=new RegExp("<(\\/)?"+r[1]+"[^<>]*(?<!\\/)>","gi");let i=1;for(;void 0===o[0]&&null!==(s=t.exec(e));)s[1]?i--:i++,0==i&&(o=[s.index,s[0].length])}let g=["",r[0],"","","","","",""];void 0!==o[0]&&(g[4]+=f(e.substr(0,o[0])),g[6]+=e.substr(o[0],o[1]));e:{if(u||void 0!==o[0]){if(void 0!==o[0]&&(e=e.substr(o[0]+o[1])),a["data-tdal-condition"]&&i.condition.exec(a["data-tdal-condition"][3])){let e=n(l(a["data-tdal-condition"][3]));if("false"==e)break e;"true"!=e&&(g[0]+="+(true==="+e+'?""',g[7]=':"")'+g[7])}let t;if(a["data-tdal-repeat"]&&(t=i.repeat.exec(a["data-tdal-repeat"][3]))){let e=l(t[2]);if("false"==e||'""'==e||"true"==e)break e;g[0]+="+(",g[0]+="false!==(t[i]="+e+")&&",g[0]+="(!Array.isArray(t[i])||(t[i]=Object.assign({},t[i])))&&",g[0]+='("object"===typeof t[i]&&0<Object.keys(t[i++]).length)&&(t[i++]=1)',g[0]+="?",g[0]+="Object.keys(t[i-2]).reduce(function(o,e){",g[0]+='r["'+t[1]+'"]=t[i-2][e];',g[0]+='r["REPEAT"]["'+t[1]+'"]={};',g[0]+='r["REPEAT"]["'+t[1]+'"]["index"]=e;',g[0]+='r["REPEAT"]["'+t[1]+'"]["number"]=t[i-1]++;',g[0]+='r["REPEAT"]["'+t[1]+'"]["even"]=0==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',g[0]+='r["REPEAT"]["'+t[1]+'"]["odd"]=1==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',g[0]+='r["REPEAT"]["'+t[1]+'"]["first"]=1==r["REPEAT"]["'+t[1]+'"]["number"];',g[0]+='r["REPEAT"]["'+t[1]+'"]["length"]=Object.keys(t[i-2]);',g[0]+='r["REPEAT"]["'+t[1]+'"]["last"]=r["REPEAT"]["'+t[1]+'"]["length"]==r["REPEAT"]["'+t[1]+'"]["number"];',g[0]+="return o",g[7]=';},""):"")+((i-=2)?"":"")'+g[7]}if(a["data-tdal-content"]&&(t=i.content.exec(a["data-tdal-content"][3]))){let e=l(t[2]);if("false"==e)g[4]="";else if("true"!=e){let r=["",""];"structure"!=t[1]&&(r[0]="(new String(",r[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),g[3]+="+(false !== (t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+r[0]+"t[i]"+r[1]+':(true!==t[i]?"":""',g[5]+="))"}}else if(a["data-tdal-replace"]&&(t=i.content.exec(a["data-tdal-replace"][3]))){let e=l(t[2]);if("false"==e)g[1]="",g[4]="",g[6]="";else if("true"!=e){let r=["",""];"structure"!=t[1]&&(r[0]="(new String(",r[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),g[0]+="+(false!==(t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+r[0]+"t[i]"+r[1]+':(true!==t[i]?"":""',g[7]="))"+g[7]}}if(a["data-tdal-attributes"]&&(t=i.attributes.exec(a["data-tdal-attributes"][3])))for(;null!==t;){let e=l(t[2]);"false"===e?void 0!==a[t[1]]&&(g[1]=g[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),"")):"true"!==e&&(g[2]+="+(false!==(t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?" '+t[1]+'=\\""+t[i]+"\\"":(true!==t[i]?"":"',void 0!==a[t[1]]?(g[1]=g[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),""),g[2]+=t[1]+'"'+(void 0!==a[t[1]][3]&&""!=a[t[1]][3]?'+"="+'+JSON.stringify(String(a[t[1]][2]+a[t[1]][3]+a[t[1]][2])):"")):g[2]+='"',g[2]+="))"),t=i.attributes.exec(a["data-tdal-attributes"][3])}if(a["data-tdal-omittag"]&&i.condition.exec(a["data-tdal-omittag"][3])){let e=n(l(a["data-tdal-omittag"][3]));"true"==e?(g[1]="",g[6]=""):"false"!=e&&(g[0]+="+("+e+'?"":""',g[3]=")"+g[3],g[5]+="+("+e+'?"":""',g[7]=")"+g[7])}}for(;null!==(s=i.attributesTDAL.exec(g[1]));)g[1]=g[1].replace(i.attributesTDAL,"")}g[1]=g[1].replace(/\s*\/?>$/,""),!u||void 0!==o[0]||""==g[4]&&""==g[3]&&""==g[5]||(g[6]="</"+r[1]+">",u=!1),t+=g[0]+"+"+JSON.stringify(String(g[1]))+g[2]+(""!=g[1]?'+"'+(u?"/":"")+'>"':"")+g[3]+g[4]+g[5]+"+"+JSON.stringify(String(g[6]))+g[7]}return t+="+"+JSON.stringify(String(e)),t}e.Compile=function(e,t=!0){let r=('let r={"REPEAT":{}},i=0,t=[]; return '+(t?"(":"")+'""'+f(e)).replace(/(?<!\\)""\+/,"").replace(/(?<!\\)"\+"/g,"").replace(/\+""$/,"")+(t?").trim()":"")+";";return new Function("d",r)}}(jTDAL||(jTDAL={})),"undefined"!=typeof exports&&(exports.Compile=jTDAL.Compile);