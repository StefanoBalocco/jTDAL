"use strict";var jTDAL;!function(t){const e="(?:[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",i="(STRING:[^;]+|(?:(?:!)?[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*))",n={pathString:new RegExp("^[\\s]*STRING:(.*)$"),tagWithTDAL:new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+["condition","repeat","content","replace","attributes","omittag"].join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i"),tagWithAttribute:new RegExp("<((?:w+:)?w+)(s+[^<>]+?)??s+%s=(['\"])(.*?)\\3(s+[^<>]+?)??s*(/)?>","i"),tagAttributes:new RegExp("(?<=\\s)((?:[\\w-]+:)?[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi"),pathInString:new RegExp("{("+e+")}","g"),condition:new RegExp("^[\\s]*(\\!?)[\\s]*"+i+"[\\s]*$"),repeat:new RegExp("^[\\s]*([\\w-]+?)[\\s]+("+e+")[\\s]*$"),content:new RegExp("^[\\s]*(?:(text|structure)[\\s]+)?("+i+")[\\s]*$"),attributes:new RegExp("[\\s]*(?:(?:([\\w-]+?)[\\s]+"+i+"[\\s]*)(?:;[\\s]*|$))","g"),attributesTDAL:new RegExp("\\s*(data-tdal-[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi")};function r(t){let e="!("+a(t)+")";switch(t){case"true":case"false":e=t}return e}function a(t){let e='"undefined"===typeof (t[i]='+t+')||false===t[i]||null===t[i]||(Array.isArray(t[i])&&1>t[i].length)||("object"===typeof t[i]&&1>Object.keys(t[i]).length)';switch(t){case"true":e="false";break;case"false":e="true"}return e}function l(t){let e="";t:{const i=t.split("|"),r=i.length;for(let t=0;t<r;++t){if(n.pathString.exec(i[t])){let r="",a=i[t].indexOf("STRING:")+7,s=null;for(;null!=(s=n.pathInString.exec(i[t]));)0<r.length&&(r+="+"),0<s.index-a&&(r+=JSON.stringify(String(i[t].substr(a,s.index-a)))+"+"),r+="("+l(s[1])+")",a=s.index+s[0].length;i[t].length>a&&(0<r.length&&(r+="+"),r+=JSON.stringify(String(i[t].substr(a)))),e+="("+r+")";break t}const r=i[t].trim().split("/");let s=0<r.length&&0<r[0].length?"!"!=r[0][0]?r[0]:r[0].substr(1):null;if(s)switch(s){case"FALSE":"!"==r[0][0]?e+="true":e+="false";break t;case"TRUE":"!"==r[0][0]?e+="false":e+="true";break t;case"REPEAT":if(3==r.length){e+="'undefined'!==typeof r['REPEAT']&&",e+="'undefined'!==typeof r['REPEAT']['"+r[1]+"']&&";let t="r['REPEAT']['"+r[1]+"']['"+r[2]+"']";e+="'undefined'!==typeof "+t+"?",e+=("!"==r[0][0]?a(t):t)+":"}break;case"GLOBAL":{const t=r.length;let i="d";for(let n=0;n<t;++n)0<n&&(e+="&&"),e+="'undefined'!==typeof "+(i=i+"['"+r[n]+"']");e+="?"+("!"==r[0][0]?a(i):i)+":";break}default:{const t=r.length;let i="r";for(let n=0;n<t;++n)0<n&&(e+="&&"),e+="'undefined'!==typeof "+(i=i+"['"+r[n]+"']");e+="?"+("!"==r[0][0]?a(i):i)+":",i="d";for(let n=0;n<t;++n)0<n&&(e+="&&"),e+="'undefined'!==typeof "+(i=i+"['"+r[n]+"']");e+="?"+("!"==r[0][0]?a(i):i)+":"}}}e+="false"}return e}t.Compile=function(t){let e=('let r={"REPEAT":{}},i=0,t=[]; return ""'+function t(e){let i="",a=null;for(;null!==(a=n.tagWithTDAL.exec(e));){0<a.index&&(i+="+"+JSON.stringify(String(e.substr(0,a.index)))),e=e.substr(a.index+a[0].length);let s,u={};for(;null!==(s=n.tagAttributes.exec(a[0]));)u[s[1]]=s;let f=!!a[6],o=[];if(!f){const t=new RegExp("<(\\/)?"+a[1]+"[^<>]*(?<!\\/)>","gi");let i=1;for(;void 0===o[0]&&null!==(s=t.exec(e));)s[1]?i--:i++,0==i&&(o=[s.index,s[0].length])}let d=["",a[0],"","","","","",""];void 0!==o[0]&&(d[4]+=t(e.substr(0,o[0])),d[6]+=e.substr(o[0],o[1]));t:{if(f||void 0!==o[0]){if(void 0!==o[0]&&(e=e.substr(o[0]+o[1])),u["data-tdal-condition"]&&n.condition.exec(u["data-tdal-condition"][3])){let t=r(l(u["data-tdal-condition"][3]));if("false"==t)break t;"true"!=t&&(d[0]+="+(undefined!=typeof (t[i]="+t+')&&null!=t[i]?""',d[7]=':"")'+d[7])}let t;if(u["data-tdal-repeat"]&&(t=n.repeat.exec(u["data-tdal-repeat"][3]))){let e=l(t[2]);if("false"==e||'""'==e||"true"==e)break t;d[0]+="+(",d[0]+="false!==(t[i]="+e+")&&",d[0]+="(!Array.isArray(t[i])||(t[i]=Object.assign({},t[i])))&&",d[0]+='("object"===typeof t[i]&&0<Object.keys(t[i++]).length)&&(t[i++]=1)',d[0]+="?",d[0]+="Object.keys(t[i-2]).reduce(function(o,e){",d[0]+='r["'+t[1]+'"]=t[i-2][e];',d[0]+='r["REPEAT"]["'+t[1]+'"]={};',d[0]+='r["REPEAT"]["'+t[1]+'"]["index"]=e;',d[0]+='r["REPEAT"]["'+t[1]+'"]["number"]=t[i-1]++;',d[0]+='r["REPEAT"]["'+t[1]+'"]["even"]=0==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',d[0]+='r["REPEAT"]["'+t[1]+'"]["odd"]=1==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',d[0]+='r["REPEAT"]["'+t[1]+'"]["first"]=1==r["REPEAT"]["'+t[1]+'"]["number"];',d[0]+='r["REPEAT"]["'+t[1]+'"]["length"]=Object.keys(t[i-2]);',d[0]+='r["REPEAT"]["'+t[1]+'"]["last"]=r["REPEAT"]["'+t[1]+'"]["length"]==r["REPEAT"]["'+t[1]+'"]["number"];',d[0]+="return o",d[7]=';},""):"")+((i-=2)?"":"")'+d[7]}if(u["data-tdal-content"]&&(t=n.content.exec(u["data-tdal-content"][3]))){let e=l(t[2]);if("false"==e)d[4]="";else if("true"!=e){let i=["",""];"structure"!=t[1]&&(i[0]="(new String(",i[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),d[3]+="+(false !== (t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+i[0]+"t[i]"+i[1]+':(true!==t[i]?"":""',d[5]+="))"}}else if(u["data-tdal-replace"]&&(t=n.content.exec(u["data-tdal-replace"][3]))){let e=l(t[2]);if("false"==e)d[1]="",d[4]="",d[6]="";else if("true"!=e){let i=["",""];"structure"!=t[1]&&(i[0]="(new String(",i[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),d[0]+="+(false!==(t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+i[0]+"t[i]"+i[1]+':(true!==t[i]?"":""',d[7]="))"+d[7]}}if(u["data-tdal-attributes"]&&(t=n.attributes.exec(u["data-tdal-attributes"][3])))for(;null!==t;){let e=l(t[2]);"false"===e?void 0!==u[t[1]]&&(d[1]=d[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*\\1)?"),"")):"true"!==e&&(d[2]+="+(false!==(t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?" '+t[1]+'=\\""+t[i]+"\\"":(true!==t[i]?"":"',void 0!==u[t[1]]?(d[1]=d[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*\\1)?"),""),d[2]+=t[1]+'"'+(void 0!==u[t[1]][3]&&""!=u[t[1]][3]?'+"="+'+JSON.stringify(String(u[t[1]][2]+u[t[1]][3]+u[t[1]][2])):"")):d[2]+='"',d[2]+="))"),t=n.attributes.exec(u["data-tdal-attributes"][3])}if(u["data-tdal-omittag"]&&n.condition.exec(u["data-tdal-omittag"][3])){let t=r(l(u["data-tdal-omittag"][3]));"true"==t?(d[1]="",d[6]=""):"false"!=t&&(d[0]+="+("+t+'?"":""',d[3]=")"+d[3],d[5]+="+("+t+'?"":""',d[7]=")"+d[7])}}for(;null!==(s=n.attributesTDAL.exec(d[1]));)d[1]=d[1].replace(n.attributesTDAL,"")}d[1]=d[1].replace(/\s*\/?>$/,""),!f||void 0!==o[0]||""==d[4]&&""==d[3]&&""==d[5]||(d[6]="</"+a[1]+">",f=!1),i+=d[0]+"+"+JSON.stringify(String(d[1]))+d[2]+(""!=d[1]?'+"'+(f?"/":"")+'>"':"")+d[3]+d[4]+d[5]+"+"+JSON.stringify(String(d[6]))+d[7]}return i+="+"+JSON.stringify(String(e))}(t)).replace(/(?<!\\)""\+/,"").replace(/(?<!\\)"\+"/g,"").replace(/\+""$/,"")+";";return new Function("d",e)}}(jTDAL||(jTDAL={})),"undefined"!=typeof exports&&(exports.Compile=jTDAL.Compile);