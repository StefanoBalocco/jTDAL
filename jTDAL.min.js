"use strict";export default class t{static t=["condition","repeat","content","replace","attributes","omittag"];static i="(?:[\\w\\-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w\\-\\/]*[\\w])*)";static l="STRING:(?:[^;](?:(?!<=;);)?)+";static o="MACRO:[a-zA-Z0-9-]+";static u="(?:(?:!)?[\\w\\-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w\\-\\/]*[\\w])*)";static p="(?:"+t.l+"|(?:"+t.u+")(?:[\\s*]\\|[\\s*]"+t.l+")?)";static h="(?:"+t.o+"|"+t.l+"|"+t.u+"(?:[\\s*]\\|[\\s*]"+t.l+")?)";static A=new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+t.t.join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i");static R=new RegExp("(?<=\\s)((?:[\\w\\-]+:)?[\\w\\-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi");static P=new RegExp("(?:{("+t.i+")}|{\\?("+t.u+")}(.*?){\\/\\2})");static m=new RegExp("^[\\s]*("+t.p+")[\\s]*$");static T=new RegExp("^[\\s]*([\\w\\-]+?)[\\s]+("+t.i+")[\\s]*$");static S=new RegExp("^[\\s]*(?:(structure)[\\s]+)?("+t.h+")[\\s]*$");static _=new RegExp("[\\s]*(?:(?:([\\w\\-]+?)[\\s]+("+t.p+")[\\s]*)(?:;;[\\s]*|$))","g");static v=new RegExp("\\s*(data-tdal-[\\w\\-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi");static N=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];O={};static k(e,r={}){let s='""',a=null;for(;null!=(a=t.P.exec(e));)if(0<a.index&&(s+="+"+JSON.stringify(String(e.substring(0,a.index)))),e=e.substring(a.index+a[0].length),a[1])s+="+(a("+t.j(a[1],!1,r)+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?t[t[0]]:"")';else if(a[2]){const e=t.j(a[2],!0,r);"true"===e?s+="+"+this.k(a[3],r):"false"!==e&&(s+="+(true==="+e+'?""+'+this.k(a[3],r)+':"")')}return 0<e.length&&(s+="+"+JSON.stringify(String(e))),s}static j(t,e=!1,r={}){let s="";if(t)t:{const a=t.split("|"),i=a.length;for(let t=0;t<i;++t){0!=t&&(s+="||");let i=a[t].replace(/^\s+/,"");if(i.startsWith("STRING:")){s+="("+this.k(i.substring(7))+")";break t}if(i.startsWith("MACRO:")){void 0!==r[i.substring(6)]?s+='("function"===typeof m["'+i.substring(6)+'"]?m["'+i.substring(6)+'"]():false)':s+="false";break t}{i=i.replace(/\s+$/,"");const t="!"===i[0],r=e||t,a=(t?i.substring(1):i).split("/");if(0<a.length&&0<a[0].length)switch(a[0]){case"FALSE":s+=t?"true":"false";break t;case"TRUE":s+=t?"false":"true";break t;case"REPEAT":3==a.length&&(s+=(r?(t?"!":"")+"b(":"")+'c(r,"'+a.join("/")+'")'+(r?")":""));break;case"GLOBAL":1<a.length&&0<a[1].length&&(s+=(r?(t?"!":"")+"b(":"")+'c(d,"'+a.slice(1).join("/")+'")'+(r?")":""));break;default:s+=r?(t?"!(":"")+'(a(c(r,"'+a.join("/")+'"))&&false!==b(t[t[0]]))||(a(c(d,"'+a.join("/")+'"))&&false!==b(t[t[0]]))'+(t?")":""):'((a(c(r,"'+a.join("/")+'"))||a(c(d,"'+a.join("/")+'")))?t[t[0]]:false)'}}}}else s="false";return s}C(e){let r="",s=null;const a="data-tdal-";for(;null!==(s=t.A.exec(e));){0<s.index&&(r+="+"+JSON.stringify(String(e.substring(0,s.index)))),e=e.substring(s.index+s[0].length);let i,n={};for(;null!==(i=t.R.exec(s[0]));)n[i[1]]=i;let l=["",s[0],"","","","","",""];l[1]=l[1].replace(t.v,"");let o=!!s[6]||t.N.includes(s[1].toLowerCase());if(!o){let t=[];const r=new RegExp("<(\\/)?"+s[1]+"[^<>]*(?<!\\/)>","gi");let a=1;for(;void 0===t[0]&&null!==(i=r.exec(e));)i[1]?a--:a++,0==a&&(t=[i.index,i[0].length]);void 0===t[0]?o=!0:(l[4]+=this.C(e.substring(0,t[0])),l[6]+=e.substring(t[0],t[0]+t[1]),e=e.substring(t[0]+t[1]))}t:{let e,r=a+t.t[0];if(n[r]&&t.m.exec(n[r][3])){let e=t.j(n[r][3],!0,this.O);if("false"===e)break t;"true"!==e&&(l[0]+="+(true==="+e+'?""',l[7]=':"")'+l[7])}if(r=a+t.t[1],n[r]&&(e=t.T.exec(n[r][3]))){let r=t.j(e[2],!1,this.O);if("false"==r||'""'==r||"true"==r)break t;l[0]+="+(",l[0]+="((",l[0]+="a("+r+")&&",l[0]+="(!Array.isArray(t[t[0]])||(t[t[0]]=Object.assign({},t[t[0]])))&&",l[0]+='("object"===typeof t[t[0]]&&null!==t[t[0]]&&Object.keys(t[t[0]]).length)',l[0]+=")?((t[++t[0]]=1)&&t[0]++):((t[0]+=2)&&false))",l[0]+="?",l[0]+="Object.keys(t[t[0]-2]).reduce((o,e)=>{",l[0]+='r["'+e[1]+'"]=t[t[0]-2][e];',l[0]+='r["REPEAT"]["'+e[1]+'"]={};',l[0]+='r["REPEAT"]["'+e[1]+'"]["index"]=e;',l[0]+='r["REPEAT"]["'+e[1]+'"]["number"]=t[t[0]-1]++;',l[0]+='r["REPEAT"]["'+e[1]+'"]["even"]=0==(r["REPEAT"]["'+e[1]+'"]["number"]%2);',l[0]+='r["REPEAT"]["'+e[1]+'"]["odd"]=1==(r["REPEAT"]["'+e[1]+'"]["number"]%2);',l[0]+='r["REPEAT"]["'+e[1]+'"]["first"]=1==r["REPEAT"]["'+e[1]+'"]["number"];',l[0]+='r["REPEAT"]["'+e[1]+'"]["length"]=Object.keys(t[t[0]-2]);',l[0]+='r["REPEAT"]["'+e[1]+'"]["last"]=r["REPEAT"]["'+e[1]+'"]["length"]==r["REPEAT"]["'+e[1]+'"]["number"];',l[0]+="return o",l[7]=';},""):"")+((t[0]-=2)&&(delete r["REPEAT"]["'+e[1]+'"])&&delete(r["'+e[1]+'"])?"":"")'+l[7]}if(r=a+t.t[2],n[r]&&(e=t.S.exec(n[r][3]))){let r=t.j(e[2],!1,this.O);if("false"==r)l[4]="";else if("true"!=r){let t=["",""];"structure"!=e[1]&&(t[0]="String(",t[1]=').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),l[3]+="+(a("+r+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?'+t[0]+"t[t[0]]"+t[1]+':(true!==t[t[0]]?"":""',l[5]+="))"}}else if(r=a+t.t[3],n[r]&&(e=t.S.exec(n[r][3]))){let r=t.j(e[2],!1,this.O);if("false"==r)l[1]="",l[4]="",l[6]="";else if("true"!=r){let t=["",""];"structure"!=e[1]&&(t[0]="String(",t[1]=').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),l[0]+="+(a("+r+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?'+t[0]+"t[t[0]]"+t[1]+':(true!==t[t[0]]?"":""',l[7]="))"+l[7]}}if(r=a+t.t[4],n[r]&&(e=t._.exec(n[r][3])))for(;null!==e;){let s=t.j(e[2],!1,this.O);"false"===s?void 0!==n[e[1]]&&(l[1]=l[1].replace(new RegExp("\\s*"+e[1]+"(?:=(['\"]).*?\\1)?"),"")):"true"!==s&&(l[2]+="+(a("+s+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?" '+e[1]+'=\\""+t[t[0]]+"\\"":(true!==t[t[0]]?"":"'+e[1]+'"',void 0!==n[e[1]]&&(l[1]=l[1].replace(new RegExp("\\s*"+e[1]+"(?:=(['\"]).*?\\1)?"),""),l[2]+=void 0!==n[e[1]][3]&&""!=n[e[1]][3]?'+"="+'+JSON.stringify(String(n[e[1]][2]+n[e[1]][3]+n[e[1]][2])):""),l[2]+="))"),e=t._.exec(n[r][3])}if(r=a+t.t[5],n[r]&&t.m.exec(n[r][3])){let e=t.j(n[r][3],!0,this.O);"true"==e?(l[1]="",l[6]=""):"false"!=e&&(l[0]+="+("+e+'?"":""',l[3]=")"+l[3],l[5]+="+("+e+'?"":""',l[7]=")"+l[7])}}l[1]=l[1].replace(/\s*\/?>$/,""),!o||""==l[4]&&""==l[3]&&""==l[5]||(l[6]="</"+s[1]+">",o=!1),r+=l[0]+"+"+JSON.stringify(String(l[1]))+l[2]+(""!=l[1]?'+"'+(o?"/":"")+'>"':"")+l[3]+l[4]+l[5]+"+"+JSON.stringify(String(l[6]))+l[7]}return r+="+"+JSON.stringify(String(e)),r}MacroAdd(t,e,r=!0,s=!0){let a=!1;return t.match(/[a-zA-Z0-9]/)&&(a=!0,this.O[t]='""'+this.C(s?e.replace(/<!--.*?-->/gs,""):e),r&&(this.O[t]="("+this.O[t]+").trim()")),a}constructor(t=[],e=!0,r=!0){const s=t.length;for(let a=0;a<s;a++)this.MacroAdd(t[a][0],t[a][1],e,r)}J(t,e=!0,r=!0){let s=this.C(r?t.replace(/<!--.*?-->/gs,""):t),a='const r={"REPEAT":{}}';a+=",t=[1]",a+=",m={"+Object.keys(this.O).map((t=>'"'+t+'":()=>'+this.O[t])).join(",")+"}",a+=",a=(e)=>{",a+="t[t[0]]=e;",a+="return false!==t[t[0]]",a+="}",a+=",c=(a,b)=>{",a+='let z=!1,y=b.split("/"),x,w;',a+="if(0<y.length&&0<y[0].length)",a+="for(z=a,x=0;x<y.length&&1!==z;x++)",a+='z="object"===typeof z&&null!==z&&void 0!==(w="function"===typeof z[y[x]]?z[y[x]](d,r):z[y[x]])&&w;',a+="return z",a+="}",a+=",b=(v)=>{",a+='return "object"===typeof v?null!==v&&0<Object.keys(v).length:(Array.isArray(v)?0<v.length:void 0!==typeof v&&false!==v&&""!==v)',a+="}",a+=";";const i=["",""];e&&(i[0]="(",i[1]=").trim()"),a+="return "+i[0]+'""'+s+i[1],s="";do{s=a,a=a.replace(/(?<!\\)"\+"/g,"").replace('(true!==t[t[0]]?"":"")','""')}while(s!=a);return a}CompileToFunction(t,e=!0,r=!0){return new Function("d",this.J(t,e,r))}CompileToString(t,e=!0,r=!0){return"function(d){"+this.J(t,e,r)+"}"}}