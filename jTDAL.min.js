"use strict";!function(e){class t{static ExpressionResultToBoolean(e){let r="!("+t.ExpressionResultNot(e)+")";switch(e){case"true":case"false":r=e}return r}static ExpressionResultNot(e){let t='"undefined"===typeof (t[i]='+e+')||false===t[i]||null===t[i]||(Array.isArray(t[i])&&1>t[i].length)||("object"===typeof t[i]&&1>Object.keys(t[i]).length)';switch(e){case"true":t="false";break;case"false":t="true"}return t}static ParsePath(e){let r="";e:{const a=e.split("|"),i=a.length;for(let e=0;e<i;++e){if(t.regexp.pathString.exec(a[e])){let i="",s=a[e].indexOf("STRING:")+7,n=null;for(;null!=(n=t.regexp.pathInString.exec(a[e]));)0<i.length&&(i+="+"),0<n.index-s&&(i+=JSON.stringify(String(a[e].substr(s,n.index-s)))+"+"),i+="("+t.ParsePath(n[1])+")",s=n.index+n[0].length;a[e].length>s&&(0<i.length&&(i+="+"),i+=JSON.stringify(String(a[e].substr(s)))),r+="("+i+")";break e}const i=a[e].trim().split("/");let s=0<i.length&&0<i[0].length?"!"!=i[0][0]?i[0]:i[0].substr(1):null;if(s)switch(s){case"FALSE":"!"==i[0][0]?r+="true":r+="false";break e;case"TRUE":"!"==i[0][0]?r+="false":r+="true";break e;case"REPEAT":if(3==i.length){r+="'undefined'!==typeof r['REPEAT']&&",r+="'undefined'!==typeof r['REPEAT']['"+i[1]+"']&&";let e="r['REPEAT']['"+i[1]+"']['"+i[2]+"']";r+="'undefined'!==typeof "+e+"?",r+=("!"==i[0][0]?t.ExpressionResultNot(e):e)+":"}break;case"GLOBAL":{const e=i.length;let a="d";for(let t=0;t<e;++t)0<t&&(r+="&&"),r+="'undefined'!==typeof "+(a=a+"['"+i[t]+"']");r+="?"+("!"==i[0][0]?t.ExpressionResultNot(a):a)+":";break}default:{const e=i.length;let a="r";for(let t=0;t<e;++t)0<t&&(r+="&&"),r+="'undefined'!==typeof "+(a=a+"['"+i[t]+"']");r+="?"+("!"==i[0][0]?t.ExpressionResultNot(a):a)+":",a="d";for(let t=0;t<e;++t)0<t&&(r+="&&"),r+="'undefined'!==typeof "+(a=a+"['"+i[t]+"']");r+="?"+("!"==i[0][0]?t.ExpressionResultNot(a):a)+":"}}}r+="false"}return r}static Parse(e){let r="",a=null;for(;null!==(a=t.regexp.tagWithTDAL.exec(e));){0<a.index&&(r+="+"+JSON.stringify(String(e.substr(0,a.index)))),e=e.substr(a.index+a[0].length);let i,s={};for(;null!==(i=t.regexp.tagAttributes.exec(a[0]));)s[i[1]]=i;let n=!!a[6],l=[];if(!n){const t=new RegExp("<(\\/)?"+a[1]+"[^<>]*(?<!\\/)>","gi");let r=1;for(;void 0===l[0]&&null!==(i=t.exec(e));)i[1]?r--:r++,0==r&&(l=[i.index,i[0].length])}let o=["",a[0],"","","","","",""];void 0!==l[0]&&(o[4]+=t.Parse(e.substr(0,l[0])),o[6]+=e.substr(l[0],l[1]));e:{if(n||void 0!==l[0]){if(void 0!==l[0]&&(e=e.substr(l[0]+l[1])),s["data-tdal-condition"]&&t.regexp.condition.exec(s["data-tdal-condition"][3])){let e=t.ExpressionResultToBoolean(t.ParsePath(s["data-tdal-condition"][3]));if("false"==e)break e;"true"!=e&&(o[0]+="+(undefined!=typeof (t[i]="+e+')&&null!=t[i]?""',o[7]=':"")'+o[7])}let r;if(s["data-tdal-repeat"]&&(r=t.regexp.repeat.exec(s["data-tdal-repeat"][3]))){let e=t.ParsePath(r[2]);if("false"==e||'""'==e||"true"==e)break e;o[0]+="+(",o[0]+="false!==(t[i]="+e+")&&",o[0]+="(!Array.isArray(t[i])||(t[i]=Object.assign({},t[i])))&&",o[0]+='("object"===typeof t[i]&&0<Object.keys(t[i++]).length)&&(t[i++]=1)',o[0]+="?",o[0]+="Object.keys(t[i-2]).reduce(function(o,e){",o[0]+='r["'+r[1]+'"]=t[i-2][e];',o[0]+='r["REPEAT"]["'+r[1]+'"]={};',o[0]+='r["REPEAT"]["'+r[1]+'"]["index"]=e;',o[0]+='r["REPEAT"]["'+r[1]+'"]["number"]=t[i-1]++;',o[0]+='r["REPEAT"]["'+r[1]+'"]["even"]=0==(r["REPEAT"]["'+r[1]+'"]["number"]%2);',o[0]+='r["REPEAT"]["'+r[1]+'"]["odd"]=1==(r["REPEAT"]["'+r[1]+'"]["number"]%2);',o[0]+='r["REPEAT"]["'+r[1]+'"]["first"]=1==r["REPEAT"]["'+r[1]+'"]["number"];',o[0]+='r["REPEAT"]["'+r[1]+'"]["length"]=Object.keys(t[i-2]);',o[0]+='r["REPEAT"]["'+r[1]+'"]["last"]=r["REPEAT"]["'+r[1]+'"]["length"]==r["REPEAT"]["'+r[1]+'"]["number"];',o[0]+="return o",o[7]=';},""):"")+((i-=2)?"":"")'+o[7]}if(s["data-tdal-content"]&&(r=t.regexp.content.exec(s["data-tdal-content"][3]))){let e=t.ParsePath(r[2]);if("false"==e)o[4]="";else if("true"!=e){let t=["",""];"structure"!=r[1]&&(t[0]="(new String(",t[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),o[3]+="+(false !== (t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+t[0]+"t[i]"+t[1]+':(true!==t[i]?"":""',o[5]+="))"}}else if(s["data-tdal-replace"]&&(r=t.regexp.content.exec(s["data-tdal-replace"][3]))){let e=t.ParsePath(r[2]);if("false"==e)o[1]="",o[4]="",o[6]="";else if("true"!=e){let t=["",""];"structure"!=r[1]&&(t[0]="(new String(",t[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),o[0]+="+(false!==(t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+t[0]+"t[i]"+t[1]+':(true!==t[i]?"":""',o[7]="))"+o[7]}}if(s["data-tdal-attributes"]&&(r=t.regexp.attributes.exec(s["data-tdal-attributes"][3])))for(;null!==r;){let e=t.ParsePath(r[2]);"false"===e?void 0!==s[r[1]]&&(o[1]=o[1].replace(new RegExp("\\s*"+r[1]+"(?:=(['\"]).*\\1)?"),"")):"true"!==e&&(o[2]+="+(false!==(t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?" '+r[1]+'=\\""+t[i]+"\\"":(true!==t[i]?"":"',void 0!==s[r[1]]?(o[1]=o[1].replace(new RegExp("\\s*"+r[1]+"(?:=(['\"]).*\\1)?"),""),o[2]+=r[1]+'"'+(void 0!==s[r[1]][3]&&""!=s[r[1]][3]?'+"="+'+JSON.stringify(String(s[r[1]][2]+s[r[1]][3]+s[r[1]][2])):"")):o[2]+='"',o[2]+="))"),r=t.regexp.attributes.exec(s["data-tdal-attributes"][3])}if(s["data-tdal-omittag"]&&t.regexp.condition.exec(s["data-tdal-omittag"][3])){let e=t.ExpressionResultToBoolean(t.ParsePath(s["data-tdal-omittag"][3]));"true"==e?(o[1]="",o[6]=""):"false"!=e&&(o[0]+="+("+e+'?"":""',o[3]=")"+o[3],o[5]+="+("+e+'?"":""',o[7]=")"+o[7])}}for(;null!==(i=t.regexp.attributesTDAL.exec(o[1]));)o[1]=o[1].replace(t.regexp.attributesTDAL,"")}o[1]=o[1].replace(/\s*\/?>$/,""),!n||void 0!==l[0]||""==o[4]&&""==o[3]&&""==o[5]||(o[6]="</"+a[1]+">",n=!1),r+=o[0]+"+"+JSON.stringify(String(o[1]))+o[2]+(""!=o[1]?'+"'+(n?"/":"")+'>"':"")+o[3]+o[4]+o[5]+"+"+JSON.stringify(String(o[6]))+o[7]}return r+="+"+JSON.stringify(String(e))}static Compile(e){let r=('let r={"REPEAT":{}},i=0,t=[]; return ""'+t.Parse(e)).replace(/(?<!\\)""\+/,"").replace(/(?<!\\)"\+"/g,"").replace(/\+""$/,"")+";";return new Function("d",r)}}t.regexpPatternPath="(?:[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",t.regexpPatternPathAllowedBoolean="(?:(?:!)?[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",t.regexpPatternExpression="(STRING:[^;]+|"+t.regexpPatternPathAllowedBoolean+")",t.regexpPatternExpressionAllowedBoolean="(STRING:[^;]+|"+t.regexpPatternPathAllowedBoolean+")",t.keywords=["condition","repeat","content","replace","attributes","omittag"],t.regexp={pathString:new RegExp("^[\\s]*STRING:(.*)$"),tagWithTDAL:new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+t.keywords.join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i"),tagWithAttribute:new RegExp("<((?:w+:)?w+)(s+[^<>]+?)??s+%s=(['\"])(.*?)\\3(s+[^<>]+?)??s*(/)?>","i"),tagAttributes:new RegExp("(?<=\\s)((?:[\\w-]+:)?[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi"),pathInString:new RegExp("{("+t.regexpPatternPath+")}","g"),condition:new RegExp("^[\\s]*(\\!?)[\\s]*"+t.regexpPatternExpressionAllowedBoolean+"[\\s]*$"),repeat:new RegExp("^[\\s]*([\\w-]+?)[\\s]+("+t.regexpPatternPath+")[\\s]*$"),content:new RegExp("^[\\s]*(?:(text|structure)[\\s]+)?("+t.regexpPatternExpressionAllowedBoolean+")[\\s]*$"),attributes:new RegExp("[\\s]*(?:(?:([\\w-]+?)[\\s]+"+t.regexpPatternExpressionAllowedBoolean+"[\\s]*)(?:;[\\s]*|$))","g"),attributesTDAL:new RegExp("\\s*(data-tdal-[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi")},e.Compile=t.Compile}("undefined"==typeof exports?this.jTDAL={}:exports);