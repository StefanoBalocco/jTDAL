"use strict";var jTDAL;!function(e){const t="(?:[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",r="(STRING:[^;]+|(?:(?:!)?[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*))",i={pathString:new RegExp("^[\\s]*STRING:(.*)$"),tagWithTDAL:new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+["condition","repeat","content","replace","attributes","omittag"].join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i"),tagWithAttribute:new RegExp("<((?:w+:)?w+)(s+[^<>]+?)??s+%s=(['\"])(.*?)\\3(s+[^<>]+?)??s*(/)?>","i"),tagAttributes:new RegExp("(?<=\\s)((?:[\\w-]+:)?[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi"),pathInString:new RegExp("{("+t+")}","g"),condition:new RegExp("^[\\s]*("+r+")[\\s]*$"),repeat:new RegExp("^[\\s]*([\\w-]+?)[\\s]+("+t+")[\\s]*$"),content:new RegExp("^[\\s]*(?:(text|structure)[\\s]+)?("+r+")[\\s]*$"),attributes:new RegExp("[\\s]*(?:(?:([\\w-]+?)[\\s]+("+r+")[\\s]*)(?:;[\\s]*|$))","g"),attributesTDAL:new RegExp("\\s*(data-tdal-[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi")};function n(e){let t="";switch(e){case"true":case"false":t=e;break;default:t="!"===e[0]?"!"+e:"!("+function(e){let t='"undefined"===typeof (t[i++]='+e+')||false===t[--i]||null===t[i]||(Array.isArray(t[i])&&1>t[i].length)||("object"===typeof t[i]&&1>Object.keys(t[i]).length)';switch(e){case"true":t="false";break;case"false":t="true"}return t}(e)+")"}return t}function s(e){let t="";if(e){let r=0;e:{const n=e.split("|"),l=n.length;for(let e=0;e<l;++e){const l=n[e].trim();if(i.pathString.exec(l)){let e="",r=l.indexOf("STRING:")+7,n=null;for(;null!=(n=i.pathInString.exec(l));)0<e.length&&(e+="+"),0<n.index-r&&(e+=JSON.stringify(String(l.substr(r,n.index-r)))+"+"),e+="("+s(n[1])+")",r=n.index+n[0].length;l.length>r&&(0<e.length&&(e+="+"),e+=JSON.stringify(String(l.substr(r)))),t+="("+e+")";break e}const f="!"===l[0],a=(f?l.substring(1):l).split("/");if(0<a.length&&0<a[0].length)switch(a[0]){case"FALSE":t+=f?"true":"false";break e;case"TRUE":t+=f?"false":"true";break e;case"REPEAT":if(3==a.length){r++,t+=(f?"(!":"")+"('undefined'!==typeof r['REPEAT']&&",t+="'undefined'!==typeof r['REPEAT']['"+a[1]+"']&&";let e="r['REPEAT']['"+a[1]+"']['"+a[2]+"']";t+="'undefined'!==typeof "+e,t+=(f?")?true":"?"+e)+":"}break;case"GLOBAL":{const e=a.length;let i="d";r++,t+=f?"(!(":"(";for(let r=0;r<e;++r)0<r&&(t+="&&"),i=i+"['"+a[r]+"']",t+="'undefined'!==typeof "+i;t+=(f?")?true":"?"+i)+":";break}default:{const e=a.length;let i="r";r++,t+=f?"(!((":"(";for(let r=0;r<e;++r)0<r&&(t+="&&"),i=i+"['"+a[r]+"']",t+="'undefined'!==typeof "+i;t+=f?")||":"?"+i+":",i="d",f||r++,t+="(";for(let r=0;r<e;++r)0<r&&(t+="&&"),i=i+"['"+a[r]+"']",t+="'undefined'!==typeof "+i;t+=(f?"))?true":"?"+i)+":"}}}t+="false"}for(let e=0;e<r;e++)t+=")"}else t="false";return t}function l(e){let t="",r=null;for(;null!==(r=i.tagWithTDAL.exec(e));){0<r.index&&(t+="+"+JSON.stringify(String(e.substr(0,r.index)))),e=e.substr(r.index+r[0].length);let f,a={};for(;null!==(f=i.tagAttributes.exec(r[0]));)a[f[1]]=f;let u=!!r[6],o=[];if(!u){const t=new RegExp("<(\\/)?"+r[1]+"[^<>]*(?<!\\/)>","gi");let i=1;for(;void 0===o[0]&&null!==(f=t.exec(e));)f[1]?i--:i++,0==i&&(o=[f.index,f[0].length]);void 0===o[0]&&(u=!0)}let g=["",r[0],"","","","","",""];u||(g[4]+=l(e.substr(0,o[0])),g[6]+=e.substr(o[0],o[1]));e:{if(u||(e=e.substr(o[0]+o[1])),a["data-tdal-condition"]&&i.condition.exec(a["data-tdal-condition"][3])){let e=n(s(a["data-tdal-condition"][3]));if("false"==e)break e;"true"!=e&&(g[0]+="+(true==="+e+'?""',g[7]=':"")'+g[7])}let t;if(a["data-tdal-repeat"]&&(t=i.repeat.exec(a["data-tdal-repeat"][3]))){let e=s(t[2]);if("false"==e||'""'==e||"true"==e)break e;g[0]+="+(",g[0]+="false!==(t[i]="+e+")&&",g[0]+="(!Array.isArray(t[i])||(t[i]=Object.assign({},t[i])))&&",g[0]+='("object"===typeof t[i]&&0<Object.keys(t[i++]).length)&&(t[i++]=1)',g[0]+="?",g[0]+="Object.keys(t[i-2]).reduce(function(o,e){",g[0]+='r["'+t[1]+'"]=t[i-2][e];',g[0]+='r["REPEAT"]["'+t[1]+'"]={};',g[0]+='r["REPEAT"]["'+t[1]+'"]["index"]=e;',g[0]+='r["REPEAT"]["'+t[1]+'"]["number"]=t[i-1]++;',g[0]+='r["REPEAT"]["'+t[1]+'"]["even"]=0==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',g[0]+='r["REPEAT"]["'+t[1]+'"]["odd"]=1==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',g[0]+='r["REPEAT"]["'+t[1]+'"]["first"]=1==r["REPEAT"]["'+t[1]+'"]["number"];',g[0]+='r["REPEAT"]["'+t[1]+'"]["length"]=Object.keys(t[i-2]);',g[0]+='r["REPEAT"]["'+t[1]+'"]["last"]=r["REPEAT"]["'+t[1]+'"]["length"]==r["REPEAT"]["'+t[1]+'"]["number"];',g[0]+="return o",g[7]=';},""):"")+((i-=2)?"":"")'+g[7]}if(a["data-tdal-content"]&&(t=i.content.exec(a["data-tdal-content"][3]))){let e=s(t[2]);if("false"==e)g[4]="";else if("true"!=e){let r=["",""];"structure"!=t[1]&&(r[0]="(new String(",r[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),g[3]+="+(false !== (t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+r[0]+"t[i]"+r[1]+':(true!==t[i]?"":""',g[5]+="))"}}else if(a["data-tdal-replace"]&&(t=i.content.exec(a["data-tdal-replace"][3]))){let e=s(t[2]);if("false"==e)g[1]="",g[4]="",g[6]="";else if("true"!=e){let r=["",""];"structure"!=t[1]&&(r[0]="(new String(",r[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),g[0]+="+(false!==(t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+r[0]+"t[i]"+r[1]+':(true!==t[i]?"":""',g[7]="))"+g[7]}}if(a["data-tdal-attributes"]&&(t=i.attributes.exec(a["data-tdal-attributes"][3])))for(;null!==t;){let e=s(t[2]);"false"===e?void 0!==a[t[1]]&&(g[1]=g[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),"")):"true"!==e&&(g[2]+="+(false!==(t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?" '+t[1]+'=\\""+t[i]+"\\"":(true!==t[i]?"":"',void 0!==a[t[1]]?(g[1]=g[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),""),g[2]+=t[1]+'"'+(void 0!==a[t[1]][3]&&""!=a[t[1]][3]?'+"="+'+JSON.stringify(String(a[t[1]][2]+a[t[1]][3]+a[t[1]][2])):"")):g[2]+='"',g[2]+="))"),t=i.attributes.exec(a["data-tdal-attributes"][3])}if(a["data-tdal-omittag"]&&i.condition.exec(a["data-tdal-omittag"][3])){let e=n(s(a["data-tdal-omittag"][3]));"true"==e?(g[1]="",g[6]=""):"false"!=e&&(g[0]+="+("+e+'?"":""',g[3]=")"+g[3],g[5]+="+("+e+'?"":""',g[7]=")"+g[7])}for(;null!==(f=i.attributesTDAL.exec(g[1]));)g[1]=g[1].replace(i.attributesTDAL,"")}g[1]=g[1].replace(/\s*\/?>$/,""),!u||""==g[4]&&""==g[3]&&""==g[5]||(g[6]="</"+r[1]+">",u=!1),t+=g[0]+"+"+JSON.stringify(String(g[1]))+g[2]+(""!=g[1]?'+"'+(u?"/":"")+'>"':"")+g[3]+g[4]+g[5]+"+"+JSON.stringify(String(g[6]))+g[7]}return t+="+"+JSON.stringify(String(e)),t}e.Compile=function(e,t=!0){let r=('let r={"REPEAT":{}},i=0,t=[]; return '+(t?"(":"")+'""'+l(e)).replace(/(?<!\\)""\+/,"").replace(/(?<!\\)"\+"/g,"").replace(/\+""$/,"")+(t?").trim()":"")+";";return new Function("d",r)}}(jTDAL||(jTDAL={})),"undefined"!=typeof exports&&(exports.Compile=jTDAL.Compile);