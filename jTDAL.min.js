"use strict";var jTDAL;!function(t){const e="(?:[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",r="(?:(?:!)?[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",n="(STRING:(?:[^;](?:(?!<=;);)?)+|"+r+")",s={tagWithTDAL:new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+["condition","repeat","content","replace","attributes","omittag"].join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i"),tagWithAttribute:new RegExp("<((?:w+:)?w+)(s+[^<>]+?)??s+%s=(['\"])(.*?)\\3(s+[^<>]+?)??s*(/)?>","i"),tagAttributes:new RegExp("(?<=\\s)((?:[\\w-]+:)?[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi"),pathString:new RegExp("(?:{("+e+")}|{\\?("+r+")}(.*?){\\?\\2})"),pathInString:new RegExp("{("+e+")}","g"),conditionInString:new RegExp("{\\?("+r+")}(.*?){\\?\\1}","g"),condition:new RegExp("^[\\s]*("+n+")[\\s]*$"),repeat:new RegExp("^[\\s]*([\\w-]+?)[\\s]+("+e+")[\\s]*$"),content:new RegExp("^[\\s]*(?:(text|structure)[\\s]+)?("+n+")[\\s]*$"),attributes:new RegExp("[\\s]*(?:(?:([\\w-]+?)[\\s]+("+n+")[\\s]*)(?:;;[\\s]*|$))","g"),attributesTDAL:new RegExp("\\s*(data-tdal-[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi")},i=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];function l(t,e){let r='""',n=null;for(;null!=(n=s.pathString.exec(t));)if(0<n.index&&(r+="+"+JSON.stringify(String(t.substring(0,n.index)))),t=t.substring(n.index+n[0].length),n[1])r+="+(a("+a(n[1],e,!1)+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?t[t[0]]:"")';else if(n[2]){const t=a(n[2],e,!0);"true"===t?r+="+"+l(n[3],e):"false"!==t&&(r+="+(true==="+t+'?""+'+l(n[3],e)+':"")')}return 0<t.length&&(r+="+"+JSON.stringify(String(t))),r}function a(t,e,r=!1){let n="";if(t){let s=0;t:{const i=t.split("|"),a=i.length;for(let t=0;t<a;++t){0!=t&&(n+="||");const a=i[t].replace(/^\s+/,"");if(a.startsWith("STRING:")){n+="("+l(a.substring(7),e)+")";break t}{const t="!"===a[0],i=r||t,l=(t?a.substring(1):a).split("/");if(e.Bool||=i,0<l.length&&0<l[0].length)switch(l[0]){case"FALSE":n+=t?"true":"false";break t;case"TRUE":n+=t?"false":"true";break t;case"REPEAT":3==l.length&&(e.Check=!0,e.Repeat=!0,n+=(i?(t?"!":"")+"b(":"")+'c(r,"'+l.join("/")+'")'+(i?")":""));break;case"GLOBAL":1<l.length&&0<l[1].length&&(e.Check=!0,n+=(i?(t?"!":"")+"b(":"")+'c(d,"'+l.slice(1).join("/")+'")'+(i?")":""));break;default:e.Check=!0,s++,n+="(",e.Repeat&&(n+=(i?(t?"!":"")+"b(":"")+'c(r,"'+l.join("/")+'")'+(i?")":""),n+=i&&t?"&&":"||"),n+=(i?(t?"!":"")+"b(":"")+'c(d,"'+l.join("/")+'")'+(i?")":"")}}}}for(let t=0;t<s;t++)n+=")"}else n="false";return n}function u(t,e){let r="",n=null;for(;null!==(n=s.tagWithTDAL.exec(t));){0<n.index&&(r+="+"+JSON.stringify(String(t.substring(0,n.index)))),t=t.substring(n.index+n[0].length);let l,o={};for(;null!==(l=s.tagAttributes.exec(n[0]));)o[l[1]]=l;let f=["",n[0],"","","","","",""];f[1]=f[1].replace(s.attributesTDAL,"");let g=!!n[6]||i.includes(n[1].toLowerCase());if(!g){let r=[];const s=new RegExp("<(\\/)?"+n[1]+"[^<>]*(?<!\\/)>","gi");let i=1;for(;void 0===r[0]&&null!==(l=s.exec(t));)l[1]?i--:i++,0==i&&(r=[l.index,l[0].length]);void 0===r[0]?g=!0:(f[4]+=u(t.substring(0,r[0]),e),f[6]+=t.substring(r[0],r[0]+r[1]),t=t.substring(r[0]+r[1]))}t:{if(o["data-tdal-condition"]&&s.condition.exec(o["data-tdal-condition"][3])){let t=a(o["data-tdal-condition"][3],e,!0);if("false"===t)break t;"true"!==t&&(f[0]+="+(true==="+t+'?""',f[7]=':"")'+f[7])}let t;if(o["data-tdal-repeat"]&&(t=s.repeat.exec(o["data-tdal-repeat"][3]))){let r=a(t[2],e,!1);if("false"==r||'""'==r||"true"==r)break t;f[0]+="+(",f[0]+="a("+r+")&&",f[0]+="(!Array.isArray(t[t[0]])||(t[t[0]]=Object.assign({},t[t[0]])))&&",f[0]+='("object"===typeof t[t[0]]&&null!==t[t[0]]&&0<Object.keys(t[t[0]++]).length)&&(t[t[0]++]=1)',f[0]+="?",f[0]+="Object.keys(t[t[0]-2]).reduce((o,e)=>{",f[0]+='r["'+t[1]+'"]=t[t[0]-2][e];',f[0]+='r["REPEAT"]["'+t[1]+'"]={};',f[0]+='r["REPEAT"]["'+t[1]+'"]["index"]=e;',f[0]+='r["REPEAT"]["'+t[1]+'"]["number"]=t[t[0]-1]++;',f[0]+='r["REPEAT"]["'+t[1]+'"]["even"]=0==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',f[0]+='r["REPEAT"]["'+t[1]+'"]["odd"]=1==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',f[0]+='r["REPEAT"]["'+t[1]+'"]["first"]=1==r["REPEAT"]["'+t[1]+'"]["number"];',f[0]+='r["REPEAT"]["'+t[1]+'"]["length"]=Object.keys(t[t[0]-2]);',f[0]+='r["REPEAT"]["'+t[1]+'"]["last"]=r["REPEAT"]["'+t[1]+'"]["length"]==r["REPEAT"]["'+t[1]+'"]["number"];',f[0]+="return o",e.Repeat=!0,f[7]=';},""):"")+((t[0]-=2)?"":"")'+f[7]}if(o["data-tdal-content"]&&(t=s.content.exec(o["data-tdal-content"][3]))){let r=a(t[2],e,!1);if("false"==r)f[4]="";else if("true"!=r){let e=["",""];"structure"!=t[1]&&(e[0]="String(",e[1]=').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),f[3]+="+(a("+r+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?'+e[0]+"t[t[0]]"+e[1]+':(true!==t[t[0]]?"":""',f[5]+="))"}}else if(o["data-tdal-replace"]&&(t=s.content.exec(o["data-tdal-replace"][3]))){let r=a(t[2],e,!1);if("false"==r)f[1]="",f[4]="",f[6]="";else if("true"!=r){let e=["",""];"structure"!=t[1]&&(e[0]="String(",e[1]=').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),f[0]+="+(a("+r+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?'+e[0]+"t[t[0]]"+e[1]+':(true!==t[t[0]]?"":""',f[7]="))"+f[7]}}if(o["data-tdal-attributes"]&&(t=s.attributes.exec(o["data-tdal-attributes"][3])))for(;null!==t;){let r=a(t[2],e,!1);"false"===r?void 0!==o[t[1]]&&(f[1]=f[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),"")):"true"!==r&&(f[2]+="+(a("+r+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?" '+t[1]+'=\\""+t[t[0]]+"\\"":(true!==t[t[0]]?"":"'+t[1]+'"',void 0!==o[t[1]]&&(f[1]=f[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),""),f[2]+=void 0!==o[t[1]][3]&&""!=o[t[1]][3]?'+"="+'+JSON.stringify(String(o[t[1]][2]+o[t[1]][3]+o[t[1]][2])):""),f[2]+="))"),t=s.attributes.exec(o["data-tdal-attributes"][3])}if(o["data-tdal-omittag"]&&s.condition.exec(o["data-tdal-omittag"][3])){let t=a(o["data-tdal-omittag"][3],e,!0);"true"==t?(f[1]="",f[6]=""):"false"!=t&&(f[0]+="+("+t+'?"":""',f[3]=")"+f[3],f[5]+="+("+t+'?"":""',f[7]=")"+f[7])}}f[1]=f[1].replace(/\s*\/?>$/,""),!g||""==f[4]&&""==f[3]&&""==f[5]||(f[6]="</"+n[1]+">",g=!1),r+=f[0]+"+"+JSON.stringify(String(f[1]))+f[2]+(""!=f[1]?'+"'+(g?"/":"")+'>"':"")+f[3]+f[4]+f[5]+"+"+JSON.stringify(String(f[6]))+f[7]}return r+="+"+JSON.stringify(String(t)),r}function o(t,e=!0,r=!0){const n={Check:!1,Bool:!1,Repeat:!1};let s=u(r?t.replace(/<!--.*?-->/gs,""):t,n),i="let "+(n.Repeat?'r={"REPEAT":{}},':"")+"t=[1];";i+="const ",i+="a=(e)=>{",i+="t[t[0]]=e;",i+="return 1",i+="}",n.Check&&(i+=",c=(a,b)=>{",i+='let z=!1,y=b.split("/"),x,w;',i+="if(0<y.length&&0<y[0].length)",i+="for(z=a,x=0;x<y.length&&1!==z;x++)",i+='z="object"===typeof z&&null!==z&&void 0!==(w="function"===typeof z[y[x]]?z[y[x]](d,'+(n.Repeat?"r":"{}")+"):z[y[x]])&&w;",i+="return z",i+="}",n.Bool&&(i+=",b=(v)=>{",i+='return "object"===typeof v?null!==v&&0<Object.keys(v).length:(Array.isArray(v)?0<v.length:void 0!==typeof v&&false!==v&&""!==v)',i+="}"),i+=";"),i+="return "+(e?"(":"")+'""'+s+(e?").trim()":""),s="";do{s=i,i=i.replace(/(?<!\\)"\+"/g,"").replace('(true!==t[t[0]]?"":"")','""')}while(s!=i);return i}t.CompileToFunction=function(t,e=!0,r=!0){return new Function("d",o(t,e,r))},t.CompileToString=function(t,e=!0,r=!0){return"function(d){"+o(t,e,r)+"}"}}(jTDAL||(jTDAL={}));export default{CompileToFunction:jTDAL.CompileToFunction,CompileToString:jTDAL.CompileToString};