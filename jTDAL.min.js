"use strict";var jTDAL;!function(t){const e="(?:[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",i="(?:(?:!)?[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",r="(STRING:[^;]+|"+i+")",n={tagWithTDAL:new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+["condition","repeat","content","replace","attributes","omittag"].join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i"),tagWithAttribute:new RegExp("<((?:w+:)?w+)(s+[^<>]+?)??s+%s=(['\"])(.*?)\\3(s+[^<>]+?)??s*(/)?>","i"),tagAttributes:new RegExp("(?<=\\s)((?:[\\w-]+:)?[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi"),pathString:new RegExp("(?:{("+e+")}|{\\?("+i+")}(.*?){\\?\\2})"),pathInString:new RegExp("{("+e+")}","g"),conditionInString:new RegExp("{\\?("+i+")}(.*?){\\?\\1}","g"),condition:new RegExp("^[\\s]*("+r+")[\\s]*$"),repeat:new RegExp("^[\\s]*([\\w-]+?)[\\s]+("+e+")[\\s]*$"),content:new RegExp("^[\\s]*(?:(text|structure)[\\s]+)?("+r+")[\\s]*$"),attributes:new RegExp("[\\s]*(?:(?:([\\w-]+?)[\\s]+("+r+")[\\s]*)(?:;[\\s]*|$))","g"),attributesTDAL:new RegExp("\\s*(data-tdal-[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi")},s=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];function l(t){let e='""',i=null;for(;null!=(i=n.pathString.exec(t));)if(0<i.index&&(e+="+"+JSON.stringify(String(t.substr(0,i.index)))),t=t.substr(i.index+i[0].length),i[1])e+="+"+f(i[1]);else if(i[2]){const t=f(i[2],!0);"true"===t?e+="+"+l(i[3]):"false"!==t&&(e+="+(true==="+t+'?""+'+l(i[3])+':"")')}return 0<t.length&&(e+="+"+JSON.stringify(String(t))),e}function f(t,e=!1){let i="";if(t){let r=0;t:{const n=t.split("|"),s=n.length;for(let t=0;t<s;++t){const s=n[t].replace(/^\s+/,"");if(s.startsWith("STRING:")){i+="("+l(s.substr(7))+")";break t}{const t="!"===s[0],n=e||t,l=(t?s.substring(1):s).split("/");if(0<l.length&&0<l[0].length)switch(l[0]){case"FALSE":i+=t?"true":"false";break t;case"TRUE":i+=t?"false":"true";break t;case"REPEAT":if(3==l.length){r++,i+=(n?"("+(t?"!":""):"")+'("undefined"!==typeof r["REPEAT"]&&',i+='"undefined"!==typeof r["REPEAT"]["'+l[1]+'"]&&';let e='r["REPEAT"]["'+l[1]+'"]["'+l[2]+'"]';i+='"undefined"!==typeof '+e,i+=(n?")?false!==(t[i]="+e+")&&null!==t[i]":"?"+e)+":"}break;case"GLOBAL":if(1<l.length){const e=l.length;i+=(n?t?"!(":"(":"")+'"object"===typeof (t[i]=d)';for(let t=1;t<e;++t){i+="&&";let e='t[i]["'+l[t]+'"]';i+='"undefined"!==typeof ',i+='(t[i]=("function"===typeof '+e+"?"+e+"(r,d)):"+e+")"}i+=(n?'?"object"===typeof t[i]?0<Object.keys(t[i]).length:(Array.isArray(t[i])?0<t[i].length:false!==t[i]&&null!==t[i]):false)?true':"?t[i]")+":"}break;default:{const e=l.length;r++,i+="("+(n?(t?"!":"")+"(":"")+'"object"===typeof (t[i]=r)';for(let t=0;t<e;++t){i+="&&";let e='t[i]["'+l[t]+'"]';i+='"undefined"!==typeof ',i+='(t[i]=("function"===typeof '+e+"?"+e+"(d,r):"+e+"))"}i+=n?'?"object"===typeof t[i]?0<Object.keys(t[i]).length:(Array.isArray(t[i])?0<t[i].length:false!==t[i]&&null!==t[i]):false)'+(t?"&&":"||"):"?t[i]:",i+=(n?(t?"!":"")+"(":"")+'"object"===typeof (t[i]=d)';for(let t=0;t<e;++t){i+="&&";let e='t[i]["'+l[t]+'"]';i+='"undefined"!==typeof ',i+='(t[i]=("function"===typeof '+e+"?"+e+"(d,r):"+e+"))"}i+=(n?'?"object"===typeof t[i]?0<Object.keys(t[i]).length:(Array.isArray(t[i])?0<t[i].length:false!==t[i]&&null!==t[i]):false)?true':"?t[i]")+":"}}}}i+="false"}for(let t=0;t<r;t++)i+=")"}else i="false";return i}function o(t){let e="",i=null;for(;null!==(i=n.tagWithTDAL.exec(t));){0<i.index&&(e+="+"+JSON.stringify(String(t.substr(0,i.index)))),t=t.substr(i.index+i[0].length);let r,l={};for(;null!==(r=n.tagAttributes.exec(i[0]));)l[r[1]]=r;let a=["",i[0],"","","","","",""],u=!!i[6]||s.includes(i[1].toLowerCase());if(!u){let e=[];const n=new RegExp("<(\\/)?"+i[1]+"[^<>]*(?<!\\/)>","gi");let s=1;for(;void 0===e[0]&&null!==(r=n.exec(t));)r[1]?s--:s++,0==s&&(e=[r.index,r[0].length]);void 0===e[0]?u=!0:(a[4]+=o(t.substr(0,e[0])),a[6]+=t.substr(e[0],e[1]),t=t.substr(e[0]+e[1]))}t:{if(l["data-tdal-condition"]&&n.condition.exec(l["data-tdal-condition"][3])){let t=f(l["data-tdal-condition"][3],!0);if("false"===t)break t;"true"!==t&&(a[0]+="+(true==="+t+'?""',a[7]=':"")'+a[7])}let t;if(l["data-tdal-repeat"]&&(t=n.repeat.exec(l["data-tdal-repeat"][3]))){let e=f(t[2]);if("false"==e||'""'==e||"true"==e)break t;a[0]+="+(",a[0]+="false!==(t[i++]="+e+")&&",a[0]+="(!Array.isArray(t[--i])||(t[i]=Object.assign({},t[i])))&&",a[0]+='("object"===typeof t[i]&&0<Object.keys(t[i++]).length)&&(t[i++]=1)',a[0]+="?",a[0]+="Object.keys(t[i-2]).reduce(function(o,e){",a[0]+='r["'+t[1]+'"]=t[i-2][e];',a[0]+='r["REPEAT"]["'+t[1]+'"]={};',a[0]+='r["REPEAT"]["'+t[1]+'"]["index"]=e;',a[0]+='r["REPEAT"]["'+t[1]+'"]["number"]=t[i-1]++;',a[0]+='r["REPEAT"]["'+t[1]+'"]["even"]=0==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',a[0]+='r["REPEAT"]["'+t[1]+'"]["odd"]=1==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',a[0]+='r["REPEAT"]["'+t[1]+'"]["first"]=1==r["REPEAT"]["'+t[1]+'"]["number"];',a[0]+='r["REPEAT"]["'+t[1]+'"]["length"]=Object.keys(t[i-2]);',a[0]+='r["REPEAT"]["'+t[1]+'"]["last"]=r["REPEAT"]["'+t[1]+'"]["length"]==r["REPEAT"]["'+t[1]+'"]["number"];',a[0]+="return o",a[7]=';},""):"")+((i-=2)?"":"")'+a[7]}if(l["data-tdal-content"]&&(t=n.content.exec(l["data-tdal-content"][3]))){let e=f(t[2]);if("false"==e)a[4]="";else if("true"!=e){let i=["",""];"structure"!=t[1]&&(i[0]="(new String(",i[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),a[3]+="+(false!==(t[i++]="+e+')&&("string"===typeof t[--i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+i[0]+"t[i]"+i[1]+':(true!==t[i]?"":""',a[5]+="))"}}else if(l["data-tdal-replace"]&&(t=n.content.exec(l["data-tdal-replace"][3]))){let e=f(t[2]);if("false"==e)a[1]="",a[4]="",a[6]="";else if("true"!=e){let i=["",""];"structure"!=t[1]&&(i[0]="(new String(",i[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),a[0]+="+(false!==(t[i++]="+e+')&&("string"===typeof t[--i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+i[0]+"t[i]"+i[1]+':(true!==t[i]?"":""',a[7]="))"+a[7]}}if(l["data-tdal-attributes"]&&(t=n.attributes.exec(l["data-tdal-attributes"][3])))for(;null!==t;){let e=f(t[2]);"false"===e?void 0!==l[t[1]]&&(a[1]=a[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),"")):"true"!==e&&(a[2]+="+(false!==(t[i++]="+e+')&&("string"===typeof t[--i]||("number"===typeof t[i]&&!isNaN(t[i])))?" '+t[1]+'=\\""+t[i]+"\\"":(true!==t[i]?"":"',void 0!==l[t[1]]?(a[1]=a[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),""),a[2]+=t[1]+'"'+(void 0!==l[t[1]][3]&&""!=l[t[1]][3]?'+"="+'+JSON.stringify(String(l[t[1]][2]+l[t[1]][3]+l[t[1]][2])):"")):a[2]+='"',a[2]+="))"),t=n.attributes.exec(l["data-tdal-attributes"][3])}if(l["data-tdal-omittag"]&&n.condition.exec(l["data-tdal-omittag"][3])){let t=f(l["data-tdal-omittag"][3],!0);"true"==t?(a[1]="",a[6]=""):"false"!=t&&(a[0]+="+("+t+'?"":""',a[3]=")"+a[3],a[5]+="+("+t+'?"":""',a[7]=")"+a[7])}for(;null!==(r=n.attributesTDAL.exec(a[1]));)a[1]=a[1].replace(n.attributesTDAL,"")}a[1]=a[1].replace(/\s*\/?>$/,""),!u||""==a[4]&&""==a[3]&&""==a[5]||(a[6]="</"+i[1]+">",u=!1),e+=a[0]+"+"+JSON.stringify(String(a[1]))+a[2]+(""!=a[1]?'+"'+(u?"/":"")+'>"':"")+a[3]+a[4]+a[5]+"+"+JSON.stringify(String(a[6]))+a[7]}return e+="+"+JSON.stringify(String(t)),e}function a(t,e=!0,i=!0){return('let r={"REPEAT":{}},i=0,t=[];return '+(e?"(":"")+'""'+o(i?t.replace(/<!--.*?-->/gs,""):t)).replace(/(?<!\\)""\+/,"").replace(/(?<!\\)"\+"/g,"").replace(/\+""$/,"")+(e?").trim()":"")}t.CompileToFunction=function(t,e=!0,i=!0){return new Function("d",a(t,e,i))},t.CompileToString=function(t,e=!0,i=!0){return"function(d){"+a(t,e,i)+"}"}}(jTDAL||(jTDAL={})),"undefined"!=typeof exports&&(exports.CompileToFunction=jTDAL.CompileToFunction,exports.CompileToString=jTDAL.CompileToString);