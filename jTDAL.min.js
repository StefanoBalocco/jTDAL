"use strict";export default class t{static t=["condition","repeat","content","replace","attributes","omittag"];static i="(?:[\\w\\-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w\\-\\/]*[\\w])*)";static l="STRING:(?:[^;](?:(?!<=;);)?)+";static o="MACRO:[a-zA-Z0-9-]+";static u="(?:(?:!)?[\\w\\-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w\\-\\/]*[\\w])*)";static p="(?:"+t.l+"|(?:"+t.u+")(?:[\\s]*\\|[\\s]*"+t.l+")?)";static h="(?:"+t.o+"|"+t.l+"|"+t.u+"(?:[\\s]*\\|[\\s]*"+t.l+")?)";static A=new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+\\bdata-tdal-(?:"+t.t.join("|")+")\\b=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i");static m=/\s((?:[\w-]+:)?[\w-]+)=(?:(['"])(.*?)\2|([^>\s'"]+))/gi;static S=new RegExp("(?:{("+t.i+")}|{\\?("+t.u+")}(.*?){\\/\\2})");static _=new RegExp("^[\\s]*("+t.p+")[\\s]*$");static v=new RegExp("^[\\s]*([\\w\\-]+?)[\\s]+("+t.i+")[\\s]*$");static R=new RegExp("^[\\s]*(?:(structure)[\\s]+)?("+t.h+")[\\s]*$");static P=new RegExp("[\\s]*(?:(?:([\\w\\-]+)(\\??)[\\s]+("+t.p+")[\\s]*)(?:;;[\\s]*|$))","g");static N=/\s*(data-tdal-[\w-]+)=(?:(['"])(.*?)\2|([^>\s'"]+))/gi;static T=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]);O={};k;$;C;static J(e,r={}){let s,i='""';for(;null!=(s=t.S.exec(e));)if(0<s.index&&(i+="+"+JSON.stringify(String(e.substring(0,s.index)))),e=e.substring(s.index+s[0].length),s[1])i+="+(a("+t.j(s[1],!1,r)+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?t[t[0]]:"")';else if(s[2]){const e=t.j(s[2],!0,r);"true"===e?i+="+"+this.J(s[3],r):"false"!==e&&(i+="+(true==="+e+'?""+'+this.J(s[3],r)+':"")')}return 0<e.length&&(i+="+"+JSON.stringify(String(e))),i}static j(t,e=!1,r={}){let s="";if(t)t:{const i=t.split("|"),a=i.length;for(let t=0;t<a;++t){0!=t&&(s+="||");let a=i[t].replace(/^\s+/,"");if(a.startsWith("STRING:")){s+="("+this.J(a.substring(7))+")";break t}if(a.startsWith("MACRO:")){void 0!==r[a.substring(6)]?s+='("function"===typeof m["'+a.substring(6)+'"]?m["'+a.substring(6)+'"]():false)':s+="false";break t}{a=a.replace(/\s+$/,"");const t="!"===a[0],r=e||t,i=(t?a.substring(1):a).split("/");if(0<i.length&&0<i[0].length)switch(i[0]){case"FALSE":s+=t?"true":"false";break t;case"TRUE":s+=t?"false":"true";break t;case"REPEAT":3==i.length&&(s+=(r?(t?"!":"")+"b(":"")+'c(r,"'+i.join("/")+'")'+(r?")":""));break;case"GLOBAL":1<i.length&&0<i[1].length&&(s+=(r?(t?"!":"")+"b(":"")+'c(d,"'+i.slice(1).join("/")+'")'+(r?")":""));break;default:s+=r?(t?"!(":"")+'b(c(r,"'+i.join("/")+'"))||b(c(d,"'+i.join("/")+'"))'+(t?")":""):'([c(r,"'+i.join("/")+'"),c(d,"'+i.join("/")+'")].find((v)=>false!==v)??false)'}}}}else s="false";return s}constructor(t=!0,e=!0,r=!0){this.k=t,this.$=e,this.C=r}L(e){let r,s="";const i="data-tdal-";for(;null!==(r=t.A.exec(e));){0<r.index&&(s+="+"+JSON.stringify(String(e.substring(0,r.index)))),e=e.substring(r.index+r[0].length);let a=!!r[6]||t.T.has(r[1].toLowerCase());const n=["",r[0],"","","","","",""],l={},o=r[0].matchAll(t.m);for(const t of o)l[t[1]]=t;if(n[1]=n[1].replaceAll(t.N,""),!a){const t=new RegExp("<(\\/)?"+r[1]+"[^<>]*(?<!\\/)>","gi");let s,i=[],l=1;for(;void 0===i[0]&&null!==(s=t.exec(e));)s[1]?l--:l++,0==l&&(i=[s.index,s[0].length]);void 0===i[0]?a=!0:(n[4]+=this.L(e.substring(0,i[0])),n[6]+=e.substring(i[0],i[0]+i[1]),e=e.substring(i[0]+i[1]))}{let e,r,s=i+t.t[0];if(l[s]&&t._.exec(l[s][3])){if(r=t.j(l[s][3],!0,this.O),"false"===r)break;"true"!==r&&(n[0]+="+(true==="+r+'?""',n[7]=':"")'+n[7])}if(s=i+t.t[1],l[s]&&(e=t.v.exec(l[s][3]))){if(r=t.j(e[2],!1,this.O),"false"==r||'""'==r||"true"==r)break;this.C?(n[0]+="+(",n[0]+="(t[0]+=2)&&",n[0]+="a("+r+",-2)&&",n[0]+="Array.isArray(t[t[0]-2])&&",n[0]+="(t[t[0]-1]=t[t[0]-2].length)",n[0]+="?",n[0]+="t[t[0]-2].reduce(",n[0]+="(o,v,i)=>{",n[0]+='r["'+e[1]+'"]=v;',n[0]+="const n=i+1,l=t[t[0]-1];",n[0]+='r["REPEAT"]["'+e[1]+'"]={index:i,number:n,length:l,even:0==(n%2),odd:1==(n%2),first:1==n,last:l==n};',n[0]+="return o",n[7]=';},""):"")+((t[0]-=2)&&(delete r["REPEAT"]["'+e[1]+'"])&&(delete r["'+e[1]+'"])?"":"")'+n[7]):(n[0]+="+(",n[0]+="(t[0]+=3)&&",n[0]+="a("+r+",-3)&&",n[0]+="(",n[0]+="(Array.isArray(t[t[0]-3])&&(t[t[0]-2]=t[t[0]-3])&&(t[t[0]-3]=true))",n[0]+="||",n[0]+='("object"===typeof t[t[0]-3]&&null!==t[t[0]-3]&&(t[t[0]-2]=Object.keys(t[t[0]-3])))',n[0]+=")&&(t[t[0]-1]=t[t[0]-2].length)",n[0]+="?",n[0]+="t[t[0]-2].reduce(",n[0]+="(o,v,i)=>{",n[0]+='r["'+e[1]+'"]=(true===t[t[0]-3])?v:t[t[0]-3][v];',n[0]+="const n=i+1,l=t[t[0]-1];",n[0]+='r["REPEAT"]["'+e[1]+'"]={index:(true===t[t[0]-3])?i:v,number:n,length:l,even:0==(n%2),odd:1==(n%2),first:1==n,last:l==n};',n[0]+="return o",n[7]=';},""):"")+((t[0]-=3)&&(delete r["REPEAT"]["'+e[1]+'"])&&(delete r["'+e[1]+'"])?"":"")'+n[7])}if(s=i+t.t[2],l[s]&&(e=t.R.exec(l[s][3]))){if(r=t.j(e[2],!1,this.O),"false"==r)n[4]="";else if("true"!=r){let t=["",""];"structure"!=e[1]&&(t[0]="String(",t[1]=').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),n[3]+="+(a("+r+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?'+t[0]+"t[t[0]]"+t[1]+':(true!==t[t[0]]?"":""',n[5]+="))"}}else if(s=i+t.t[3],l[s]&&(e=t.R.exec(l[s][3])))if(r=t.j(e[2],!1,this.O),"false"==r)n[1]="",n[4]="",n[6]="";else if("true"!=r){let t=["",""];"structure"!=e[1]&&(t[0]="String(",t[1]=').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),n[0]+="+(a("+r+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?'+t[0]+"t[t[0]]"+t[1]+':(true!==t[t[0]]?"":""',n[7]="))"+n[7]}if(s=i+t.t[4],l[s]){const i=l[s][3].matchAll(t.P);for(e of i){const s="?"===e[2];r=t.j(e[3],s,this.O),"false"===r?void 0!==l[e[1]]&&(n[1]=n[1].replace(new RegExp("\\s*\\b"+e[1]+"\\b(?:=(['\"]).*?\\1)?(?=\\s|\\/?>)"),"")):"true"!==r&&(n[2]+=s?`+(${r}?" ${e[1]}":""`:`+(a(${r})&&((t[t[0]]&&"string"===typeof t[t[0]])||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?" ${e[1]}=\\""+t[t[0]]+"\\"":( true !== t[t[0]]?"":"${e[1]}"`,void 0!==l[e[1]]&&(n[1]=n[1].replace(new RegExp("\\s*\\b"+e[1]+"\\b(?:=(['\"]).*?\\1)?(?=\\s|\\/?>)"),""),n[2]+=void 0!==l[e[1]][3]&&""!=l[e[1]][3]?'+"="+'+JSON.stringify(String(l[e[1]][2]+l[e[1]][3]+l[e[1]][2])):""),n[2]+=")",s||(n[2]+=")"))}}s=i+t.t[5],l[s]&&t._.exec(l[s][3])&&(r=t.j(l[s][3],!0,this.O),"true"==r?(n[1]="",n[6]=""):"false"!=r&&(n[0]+="+("+r+'?"":""',n[3]=")"+n[3],n[5]+="+("+r+'?"":""',n[7]=")"+n[7]))}n[1]=n[1].replace(/\s*\/?>$/,""),!a||""==n[4]&&""==n[3]&&""==n[5]||(n[6]="</"+r[1]+">",a=!1),s+=n[0]+"+"+JSON.stringify(String(n[1]))+n[2]+(""!=n[1]?'+"'+(a?"/":"")+'>"':"")+n[3]+n[4]+n[5]+"+"+JSON.stringify(String(n[6]))+n[7]}return s+="+"+JSON.stringify(String(e)),s}MacroAdd(t,e){let r=!1;return t.match(/^[a-zA-Z0-9-]+$/)&&(r=!0,this.O[t]='""'+this.L(this.$?e.replace(/<!--.*?-->/gs,""):e),this.k&&(this.O[t]="("+this.O[t]+").trim()")),r}M(t){const e=["",""];let r=this.L(this.$?t.replace(/<!--.*?-->/gs,""):t),s='const r={"REPEAT":{}}';s+=",t=[1]",s+=",m={"+Object.keys(this.O).map(t=>'"'+t+'":()=>'+this.O[t]).join(",")+"}",s+=",a=(e,i=0)=>{",s+="t[t[0]+i]=e;",s+="return false!==t[t[0]+i]",s+="}",s+=",c=(a,b)=>{",s+='let z=!1,y=b.split("/"),x,w,l=y.length;',s+="if(l&&y[0].length)",s+="for(z=a,x=0;x<l&&1!==z;x++)",s+='z="object"===typeof z&&null!==z&&void 0!==(w="function"===typeof z[y[x]]?z[y[x]](d,r):z[y[x]])&&w;',s+="return z",s+="}",s+=",b=(v)=>{",s+='return v&&("object"===typeof v?0<Object.keys(v).length:(Array.isArray(v)?0<v.length:true))',s+="}",s+=";",this.k&&(e[0]="(",e[1]=").trim()"),s+="return "+e[0]+'""'+r+e[1],r="";do{r=s,s=s.replace(/(?<!\\)"\+"/g,"").replace('(true!==t[t[0]]?"":"")','""')}while(r!=s);return s}CompileToFunction(t){return new Function("d",this.M(t))}CompileToString(t){return"function(d){"+this.M(t)+"}"}}