"use strict";var jTDAL;!function(t){const e="(?:[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",i="(STRING:[^;]+|(?:(?:!)?[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*))",r={pathString:new RegExp("^[\\s]*STRING:(.*)$"),tagWithTDAL:new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+["condition","repeat","content","replace","attributes","omittag"].join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i"),tagWithAttribute:new RegExp("<((?:w+:)?w+)(s+[^<>]+?)??s+%s=(['\"])(.*?)\\3(s+[^<>]+?)??s*(/)?>","i"),tagAttributes:new RegExp("(?<=\\s)((?:[\\w-]+:)?[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi"),pathInString:new RegExp("{("+e+")}","g"),condition:new RegExp("^[\\s]*(\\!?)[\\s]*"+i+"[\\s]*$"),repeat:new RegExp("^[\\s]*([\\w-]+?)[\\s]+("+e+")[\\s]*$"),content:new RegExp("^[\\s]*(?:(text|structure)[\\s]+)?("+i+")[\\s]*$"),attributes:new RegExp("[\\s]*(?:(?:([\\w-]+?)[\\s]+"+i+"[\\s]*)(?:;[\\s]*|$))","g"),attributesTDAL:new RegExp("\\s*(data-tdal-[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi")};function n(t){let e="";switch(t){case"true":case"false":e=t;break;default:e=t.startsWith("!(")?"!"+t:"!("+a(t)+")"}return e}function a(t){let e='"undefined"===typeof (t[i++]='+t+')||false===t[--i]||null===t[i]||(Array.isArray(t[i])&&1>t[i].length)||("object"===typeof t[i]&&1>Object.keys(t[i]).length)';switch(t){case"true":e="false";break;case"false":e="true"}return e}function s(t){let e="",i=0;t:{const n=t.split("|"),l=n.length;for(let t=0;t<l;++t){if(r.pathString.exec(n[t])){let i="",a=n[t].indexOf("STRING:")+7,l=null;for(;null!=(l=r.pathInString.exec(n[t]));)0<i.length&&(i+="+"),0<l.index-a&&(i+=JSON.stringify(String(n[t].substr(a,l.index-a)))+"+"),i+="("+s(l[1])+")",a=l.index+l[0].length;n[t].length>a&&(0<i.length&&(i+="+"),i+=JSON.stringify(String(n[t].substr(a)))),e+="("+i+")";break t}const l=n[t].trim().split("/");let u=0<l.length&&0<l[0].length?"!"!=l[0][0]?l[0]:l[0].substr(1):null;if(u)switch(u){case"FALSE":"!"==l[0][0]?e+="true":e+="false";break t;case"TRUE":"!"==l[0][0]?e+="false":e+="true";break t;case"REPEAT":if(3==l.length){i++,e+="('undefined'!==typeof r['REPEAT']&&",e+="'undefined'!==typeof r['REPEAT']['"+l[1]+"']&&";let t="r['REPEAT']['"+l[1]+"']['"+l[2]+"']";e+="'undefined'!==typeof "+t+"?",e+=("!"==l[0][0]?a(t):t)+":"}break;case"GLOBAL":{const t=l.length;let r="d";i++,e+="(";for(let i=0;i<t;++i)0<i&&(e+="&&"),e+="'undefined'!==typeof "+(r=r+"['"+l[i]+"']");e+="?"+("!"==l[0][0]?a(r):r)+":";break}default:{const t=l.length;let r="r";i++,e+="(";for(let i=0;i<t;++i)0<i&&(e+="&&"),e+="'undefined'!==typeof "+(r=r+"['"+l[i]+"']");e+="?"+("!"==l[0][0]?"("+a(r)+")":r)+":",r="d",i++,e+="(";for(let i=0;i<t;++i)0<i&&(e+="&&"),e+="'undefined'!==typeof "+(r=r+"['"+l[i]+"']");e+="?"+("!"==l[0][0]?a(r):r)+":"}}}e+="false"}for(let t=0;t<i;t++)e+=")";return e}t.Compile=function(t){let e=('let r={"REPEAT":{}},i=0,t=[]; return ""'+function t(e){let i="",a=null;for(;null!==(a=r.tagWithTDAL.exec(e));){0<a.index&&(i+="+"+JSON.stringify(String(e.substr(0,a.index)))),e=e.substr(a.index+a[0].length);let l,u={};for(;null!==(l=r.tagAttributes.exec(a[0]));)u[l[1]]=l;let f=!!a[6],o=[];if(!f){const t=new RegExp("<(\\/)?"+a[1]+"[^<>]*(?<!\\/)>","gi");let i=1;for(;void 0===o[0]&&null!==(l=t.exec(e));)l[1]?i--:i++,0==i&&(o=[l.index,l[0].length])}let d=["",a[0],"","","","","",""];void 0!==o[0]&&(d[4]+=t(e.substr(0,o[0])),d[6]+=e.substr(o[0],o[1]));t:{if(f||void 0!==o[0]){if(void 0!==o[0]&&(e=e.substr(o[0]+o[1])),u["data-tdal-condition"]&&r.condition.exec(u["data-tdal-condition"][3])){let t=n(s(u["data-tdal-condition"][3]));if("false"==t)break t;"true"!=t&&(d[0]+="+(true==="+t+'?""',d[7]=':"")'+d[7])}let t;if(u["data-tdal-repeat"]&&(t=r.repeat.exec(u["data-tdal-repeat"][3]))){let e=s(t[2]);if("false"==e||'""'==e||"true"==e)break t;d[0]+="+(",d[0]+="false!==(t[i]="+e+")&&",d[0]+="(!Array.isArray(t[i])||(t[i]=Object.assign({},t[i])))&&",d[0]+='("object"===typeof t[i]&&0<Object.keys(t[i++]).length)&&(t[i++]=1)',d[0]+="?",d[0]+="Object.keys(t[i-2]).reduce(function(o,e){",d[0]+='r["'+t[1]+'"]=t[i-2][e];',d[0]+='r["REPEAT"]["'+t[1]+'"]={};',d[0]+='r["REPEAT"]["'+t[1]+'"]["index"]=e;',d[0]+='r["REPEAT"]["'+t[1]+'"]["number"]=t[i-1]++;',d[0]+='r["REPEAT"]["'+t[1]+'"]["even"]=0==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',d[0]+='r["REPEAT"]["'+t[1]+'"]["odd"]=1==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',d[0]+='r["REPEAT"]["'+t[1]+'"]["first"]=1==r["REPEAT"]["'+t[1]+'"]["number"];',d[0]+='r["REPEAT"]["'+t[1]+'"]["length"]=Object.keys(t[i-2]);',d[0]+='r["REPEAT"]["'+t[1]+'"]["last"]=r["REPEAT"]["'+t[1]+'"]["length"]==r["REPEAT"]["'+t[1]+'"]["number"];',d[0]+="return o",d[7]=';},""):"")+((i-=2)?"":"")'+d[7]}if(u["data-tdal-content"]&&(t=r.content.exec(u["data-tdal-content"][3]))){let e=s(t[2]);if("false"==e)d[4]="";else if("true"!=e){let i=["",""];"structure"!=t[1]&&(i[0]="(new String(",i[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),d[3]+="+(false !== (t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+i[0]+"t[i]"+i[1]+':(true!==t[i]?"":""',d[5]+="))"}}else if(u["data-tdal-replace"]&&(t=r.content.exec(u["data-tdal-replace"][3]))){let e=s(t[2]);if("false"==e)d[1]="",d[4]="",d[6]="";else if("true"!=e){let i=["",""];"structure"!=t[1]&&(i[0]="(new String(",i[1]=')).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),d[0]+="+(false!==(t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?'+i[0]+"t[i]"+i[1]+':(true!==t[i]?"":""',d[7]="))"+d[7]}}if(u["data-tdal-attributes"]&&(t=r.attributes.exec(u["data-tdal-attributes"][3])))for(;null!==t;){let e=s(t[2]);"false"===e?void 0!==u[t[1]]&&(d[1]=d[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*\\1)?"),"")):"true"!==e&&(d[2]+="+(false!==(t[i]="+e+')&&("string"===typeof t[i]||("number"===typeof t[i]&&!isNaN(t[i])))?" '+t[1]+'=\\""+t[i]+"\\"":(true!==t[i]?"":"',void 0!==u[t[1]]?(d[1]=d[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*\\1)?"),""),d[2]+=t[1]+'"'+(void 0!==u[t[1]][3]&&""!=u[t[1]][3]?'+"="+'+JSON.stringify(String(u[t[1]][2]+u[t[1]][3]+u[t[1]][2])):"")):d[2]+='"',d[2]+="))"),t=r.attributes.exec(u["data-tdal-attributes"][3])}if(u["data-tdal-omittag"]&&r.condition.exec(u["data-tdal-omittag"][3])){let t=n(s(u["data-tdal-omittag"][3]));"true"==t?(d[1]="",d[6]=""):"false"!=t&&(d[0]+="+("+t+'?"":""',d[3]=")"+d[3],d[5]+="+("+t+'?"":""',d[7]=")"+d[7])}}for(;null!==(l=r.attributesTDAL.exec(d[1]));)d[1]=d[1].replace(r.attributesTDAL,"")}d[1]=d[1].replace(/\s*\/?>$/,""),!f||void 0!==o[0]||""==d[4]&&""==d[3]&&""==d[5]||(d[6]="</"+a[1]+">",f=!1),i+=d[0]+"+"+JSON.stringify(String(d[1]))+d[2]+(""!=d[1]?'+"'+(f?"/":"")+'>"':"")+d[3]+d[4]+d[5]+"+"+JSON.stringify(String(d[6]))+d[7]}return i+="+"+JSON.stringify(String(e))}(t)).replace(/(?<!\\)""\+/,"").replace(/(?<!\\)"\+"/g,"").replace(/\+""$/,"")+";";return new Function("d",e)}}(jTDAL||(jTDAL={})),"undefined"!=typeof exports&&(exports.Compile=jTDAL.Compile);