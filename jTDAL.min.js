"use strict";var jTDAL;!function(t){const e="(?:[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",r="(?:(?:!)?[\\w-\\/]*[\\w](?:[\\s]*\\|[\\s]*[\\w-\\/]*[\\w])*)",n="(STRING:(?:[^;](?:(?!<=;);)?)+|"+r+")",l={tagWithTDAL:new RegExp("<((?:\\w+:)?\\w+)(\\s+[^<>]+?)??\\s+data-tdal-(?:"+["condition","repeat","content","replace","attributes","omittag"].join("|")+")=(['\"])(.*?)\\3(\\s+[^<>]+?)??\\s*(/)?>","i"),tagWithAttribute:new RegExp("<((?:w+:)?w+)(s+[^<>]+?)??s+%s=(['\"])(.*?)\\3(s+[^<>]+?)??s*(/)?>","i"),tagAttributes:new RegExp("(?<=\\s)((?:[\\w-]+:)?[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi"),pathString:new RegExp("(?:{("+e+")}|{\\?("+r+")}(.*?){\\?\\2})"),pathInString:new RegExp("{("+e+")}","g"),conditionInString:new RegExp("{\\?("+r+")}(.*?){\\?\\1}","g"),condition:new RegExp("^[\\s]*("+n+")[\\s]*$"),repeat:new RegExp("^[\\s]*([\\w-]+?)[\\s]+("+e+")[\\s]*$"),content:new RegExp("^[\\s]*(?:(text|structure)[\\s]+)?("+n+")[\\s]*$"),attributes:new RegExp("[\\s]*(?:(?:([\\w-]+?)[\\s]+("+n+")[\\s]*)(?:;;[\\s]*|$))","g"),attributesTDAL:new RegExp("\\s*(data-tdal-[\\w-]+)=(?:(['\"])(.*?)\\2|([^>\\s'\"]+))","gi")},s=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];function i(t){let e='""',r=null;for(;null!=(r=l.pathString.exec(t));)if(0<r.index&&(e+="+"+JSON.stringify(String(t.substring(0,r.index)))),t=t.substring(r.index+r[0].length),r[1])e+="+(a("+a(r[1],!1)+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?t[t[0]]:"")';else if(r[2]){const t=a(r[2],!0);"true"===t?e+="+"+i(r[3]):"false"!==t&&(e+="+(true==="+t+'?""+'+i(r[3])+':"")')}return 0<t.length&&(e+="+"+JSON.stringify(String(t))),e}function a(t,e=!1){let r="";if(t){let n=0;t:{const n=t.split("|"),l=n.length;for(let t=0;t<l;++t){0!=t&&(r+="||");let l=n[t].replace(/^\s+/,"");if(l.startsWith("STRING:")){r+="("+i(l.substring(7))+")";break t}{l=l.replace(/\s+$/,"");const t="!"===l[0],n=e||t,s=(t?l.substring(1):l).split("/");if(0<s.length&&0<s[0].length)switch(s[0]){case"FALSE":r+=t?"true":"false";break t;case"TRUE":r+=t?"false":"true";break t;case"REPEAT":3==s.length&&(r+=(n?(t?"!":"")+"b(":"")+'c(r,"'+s.join("/")+'")'+(n?")":""));break;case"GLOBAL":1<s.length&&0<s[1].length&&(r+=(n?(t?"!":"")+"b(":"")+'c(d,"'+s.slice(1).join("/")+'")'+(n?")":""));break;default:r+=n?(t?"!(":"")+'(a(c(r,"'+s.join("/")+'"))&&false!==b(t[t[0]]))||(a(c(d,"'+s.join("/")+'"))&&false!==b(t[t[0]]))'+(t?")":""):'((a(c(r,"'+s.join("/")+'"))||a(c(d,"'+s.join("/")+'")))?t[t[0]]:false)'}}}}for(let t=0;t<n;t++)r+=")"}else r="false";return r}function u(t){let e="",r=null;for(;null!==(r=l.tagWithTDAL.exec(t));){0<r.index&&(e+="+"+JSON.stringify(String(t.substring(0,r.index)))),t=t.substring(r.index+r[0].length);let n,i={};for(;null!==(n=l.tagAttributes.exec(r[0]));)i[n[1]]=n;let o=["",r[0],"","","","","",""];o[1]=o[1].replace(l.attributesTDAL,"");let f=!!r[6]||s.includes(r[1].toLowerCase());if(!f){let e=[];const l=new RegExp("<(\\/)?"+r[1]+"[^<>]*(?<!\\/)>","gi");let s=1;for(;void 0===e[0]&&null!==(n=l.exec(t));)n[1]?s--:s++,0==s&&(e=[n.index,n[0].length]);void 0===e[0]?f=!0:(o[4]+=u(t.substring(0,e[0])),o[6]+=t.substring(e[0],e[0]+e[1]),t=t.substring(e[0]+e[1]))}t:{if(i["data-tdal-condition"]&&l.condition.exec(i["data-tdal-condition"][3])){let t=a(i["data-tdal-condition"][3],!0);if("false"===t)break t;"true"!==t&&(o[0]+="+(true==="+t+'?""',o[7]=':"")'+o[7])}let t;if(i["data-tdal-repeat"]&&(t=l.repeat.exec(i["data-tdal-repeat"][3]))){let e=a(t[2],!1);if("false"==e||'""'==e||"true"==e)break t;o[0]+="+(",o[0]+="((",o[0]+="a("+e+")&&",o[0]+="(!Array.isArray(t[t[0]])||(t[t[0]]=Object.assign({},t[t[0]])))&&",o[0]+='("object"===typeof t[t[0]]&&null!==t[t[0]]&&Object.keys(t[t[0]]).length)',o[0]+=")?((t[++t[0]]=1)&&t[0]++):((t[0]+=2)&&false))",o[0]+="?",o[0]+="Object.keys(t[t[0]-2]).reduce((o,e)=>{",o[0]+='r["'+t[1]+'"]=t[t[0]-2][e];',o[0]+='r["REPEAT"]["'+t[1]+'"]={};',o[0]+='r["REPEAT"]["'+t[1]+'"]["index"]=e;',o[0]+='r["REPEAT"]["'+t[1]+'"]["number"]=t[t[0]-1]++;',o[0]+='r["REPEAT"]["'+t[1]+'"]["even"]=0==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',o[0]+='r["REPEAT"]["'+t[1]+'"]["odd"]=1==(r["REPEAT"]["'+t[1]+'"]["number"]%2);',o[0]+='r["REPEAT"]["'+t[1]+'"]["first"]=1==r["REPEAT"]["'+t[1]+'"]["number"];',o[0]+='r["REPEAT"]["'+t[1]+'"]["length"]=Object.keys(t[t[0]-2]);',o[0]+='r["REPEAT"]["'+t[1]+'"]["last"]=r["REPEAT"]["'+t[1]+'"]["length"]==r["REPEAT"]["'+t[1]+'"]["number"];',o[0]+="return o",o[7]=';},""):"")+((t[0]-=2)&&(delete r["REPEAT"]["'+t[1]+'"])&&delete(r["'+t[1]+'"])?"":"")'+o[7]}if(i["data-tdal-content"]&&(t=l.content.exec(i["data-tdal-content"][3]))){let e=a(t[2],!1);if("false"==e)o[4]="";else if("true"!=e){let r=["",""];"structure"!=t[1]&&(r[0]="String(",r[1]=').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),o[3]+="+(a("+e+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?'+r[0]+"t[t[0]]"+r[1]+':(true!==t[t[0]]?"":""',o[5]+="))"}}else if(i["data-tdal-replace"]&&(t=l.content.exec(i["data-tdal-replace"][3]))){let e=a(t[2],!1);if("false"==e)o[1]="",o[4]="",o[6]="";else if("true"!=e){let r=["",""];"structure"!=t[1]&&(r[0]="String(",r[1]=').replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;")'),o[0]+="+(a("+e+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?'+r[0]+"t[t[0]]"+r[1]+':(true!==t[t[0]]?"":""',o[7]="))"+o[7]}}if(i["data-tdal-attributes"]&&(t=l.attributes.exec(i["data-tdal-attributes"][3])))for(;null!==t;){let e=a(t[2],!1);"false"===e?void 0!==i[t[1]]&&(o[1]=o[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),"")):"true"!==e&&(o[2]+="+(a("+e+')&&("string"===typeof t[t[0]]||("number"===typeof t[t[0]]&&!isNaN(t[t[0]])))?" '+t[1]+'=\\""+t[t[0]]+"\\"":(true!==t[t[0]]?"":"'+t[1]+'"',void 0!==i[t[1]]&&(o[1]=o[1].replace(new RegExp("\\s*"+t[1]+"(?:=(['\"]).*?\\1)?"),""),o[2]+=void 0!==i[t[1]][3]&&""!=i[t[1]][3]?'+"="+'+JSON.stringify(String(i[t[1]][2]+i[t[1]][3]+i[t[1]][2])):""),o[2]+="))"),t=l.attributes.exec(i["data-tdal-attributes"][3])}if(i["data-tdal-omittag"]&&l.condition.exec(i["data-tdal-omittag"][3])){let t=a(i["data-tdal-omittag"][3],!0);"true"==t?(o[1]="",o[6]=""):"false"!=t&&(o[0]+="+("+t+'?"":""',o[3]=")"+o[3],o[5]+="+("+t+'?"":""',o[7]=")"+o[7])}}o[1]=o[1].replace(/\s*\/?>$/,""),!f||""==o[4]&&""==o[3]&&""==o[5]||(o[6]="</"+r[1]+">",f=!1),e+=o[0]+"+"+JSON.stringify(String(o[1]))+o[2]+(""!=o[1]?'+"'+(f?"/":"")+'>"':"")+o[3]+o[4]+o[5]+"+"+JSON.stringify(String(o[6]))+o[7]}return e+="+"+JSON.stringify(String(t)),e}function o(t,e=!0,r=!0){let n=u(r?t.replace(/<!--.*?-->/gs,""):t),l='let r={"REPEAT":{}},t=[1];';l+="const ",l+="a=(e)=>{",l+="t[t[0]]=e;",l+="return false!==t[t[0]]",l+="}",l+=",c=(a,b)=>{",l+='let z=!1,y=b.split("/"),x,w;',l+="if(0<y.length&&0<y[0].length)",l+="for(z=a,x=0;x<y.length&&1!==z;x++)",l+='z="object"===typeof z&&null!==z&&void 0!==(w="function"===typeof z[y[x]]?z[y[x]](d,r):z[y[x]])&&w;',l+="return z",l+="}",l+=",b=(v)=>{",l+='return "object"===typeof v?null!==v&&0<Object.keys(v).length:(Array.isArray(v)?0<v.length:void 0!==typeof v&&false!==v&&""!==v)',l+="}",l+=";",l+="return "+(e?"(":"")+'""'+n+(e?").trim()":""),n="";do{n=l,l=l.replace(/(?<!\\)"\+"/g,"").replace('(true!==t[t[0]]?"":"")','""')}while(n!=l);return l}t.CompileToFunction=function(t,e=!0,r=!0){return new Function("d",o(t,e,r))},t.CompileToString=function(t,e=!0,r=!0){return"function(d){"+o(t,e,r)+"}"}}(jTDAL||(jTDAL={}));export default{CompileToFunction:jTDAL.CompileToFunction,CompileToString:jTDAL.CompileToString};